<!DOCTYPE HTML>
<html lang="zh_CN" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>log4j2 - JAVA笔记库</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">JAVA笔记库</h1>

                    <div class="right-buttons">

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="/note-service/java/infisearch_assets/search-ui-light.css">
<style>.light .infi-root,
.rust .infi-root,
.coal .infi-root,
.navy .infi-root,
.ayu .infi-root {
    --infi-shadow: none;
    --infi-border: 3px solid var(--table-header-bg);
    --infi-bg: var(--bg);
    --infi-triangle-bg: var(--table-header-bg);
    --infi-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --infi-title-fg: var(--fg);
    --infi-title-hover-fg: var(--fg);
    --infi-title-hover-bg: var(--table-header-bg);
    --infi-title-border-bottom-hover: 2px solid var(--table-header-bg);
    --infi-heading-fg: var(--fg);
    --infi-heading-hover-fg: var(--fg);
    --infi-body-fg: var(--fg);
    --infi-body-hover-fg: var(--fg);
    --infi-sub-bg: var(--bg);
    --infi-highlight: var(--search-mark-bg);
    --infi-highlight-bg: none;
    --infi-header-fg: var(--fg);
    --infi-checkbox-bg: #f8f8f8;
    --infi-checkbox-checked-bg: #fff;
    --infi-checkbox-border: #414141;
    --infi-filter-header-active: var(--infi-title-bg);
    --infi-error-fg: var(--fg);
    --infi-fine-print-fg: var(--fg);
    --infi-loading-bg: var(--fg);
    --infi-loading-secondary-bg: var(--fg);
    --infi-load-more-fg: var(--infi-title-fg);
    --infi-load-more-bg: var(--infi-title-bg);
    --infi-load-more-hover-fg: var(--infi-title-hover-fg);
    --infi-load-more-hover-bg: var(--infi-title-hover-bg);
    --infi-scrollbar-bg: none;
    --infi-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --infi-fs-button-input-fg: var(--searchbar-shadow-color);
    --infi-fs-border: 3px solid var(--sidebar-bg);
    --infi-fs-box-shadow: none;
    --infi-fs-header-bg: var(--sidebar-bg);
    --infi-fs-header-box-shadow: none;
    --infi-tip-table-header-border: var(--table-border-color);
    --infi-tip-table-border: transparent;
    --infi-tip-table-alternate: var(--table-alternate-bg);
    --infi-tip-bg: var(--sidebar-bg);
    --infi-tip-fg: var(--sidebar-fg);
    --infi-tip-code-fg: var(--inline-code-color);
    --infi-tip-code-bg: transparent;
    --infi-tip-icon-bg: rgb(230, 230, 230);
    --infi-tip-icon-fg: rgb(80, 80, 80);
}

.light .infi-root {
    --infi-fs-header-close-fg: var(--searchresults-header-fg);
    --infi-fs-header-close-hover-fg: var(--fg);
}

.ayu .infi-root,
.rust .infi-root,
.coal .infi-root,
.navy .infi-root {
    --infi-fs-header-close-fg: var(--sidebar-fg);
    --infi-fs-header-close-hover-fg: white;
}

.ayu .infi-root,
.rust .infi-root {
    --infi-tip-code-fg: var(--search-mark-bg) !important;
    --infi-tip-icon-bg: rgb(200, 200, 200);
    --infi-tip-icon-fg: rgb(50, 50, 50);
}

.light .infi-root .infi-list-item.focus,
.rust .infi-root .infi-list-item.focus,
.coal .infi-root .infi-list-item.focus,
.navy .infi-root .infi-list-item.focus,
.ayu .infi-root .infi-list-item.focus {
    outline: 2px solid grey;
}

.light .infi-root,
.coal .infi-root,
.navy .infi-root,
.ayu .infi-root {
    --infi-title-bg: var(--theme-hover);
    --infi-sub-hover-bg: var(--table-alternate-bg);
    --infi-title-border-bottom: 2px solid var(--theme-hover);
}

.light .infi-root {
    --infi-highlight: #82a6c4;
    --infi-sub-hover-bg: #ebebeb;
}

.rust .infi-root {
    --infi-highlight: #bc8e6a;

    --infi-tip-table-alternate: var(--sidebar-bg);
    --infi-title-bg: var(--table-header-bg);
    --infi-title-border-bottom: 2px solid var(--table-header-bg);

    --infi-sub-hover-bg: #c6bbb1;
    --infi-title-bg: #bbada1;
    --infi-title-border-bottom: 2px solid #bbada1;
    --infi-title-hover-fg: #000;
    --infi-title-hover-bg: #a19488;
    --infi-title-border-bottom-hover: 2px solid #a19488;
    --infi-body-hover-fg: #1e1e1e;
    --infi-heading-hover-fg: #1e1e1e;
}

.coal .infi-root {
    --infi-highlight: #496c8a;
    --infi-sub-hover-bg: #272a2b;
}

.infi-theme .infi-root .infi-tip-item code,
.rust .infi-root .infi-tip-item code {
    color: var(--infi-tip-code-fg) !important;;
}

.coal .infi-root,
.navy .infi-root,
.ayu .infi-root {
    --infi-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
    --infi-fs-input-fg: var(--fg);
    --infi-fs-input-focus-border: 2px solid #4f95cc;
    --infi-fs-input-focus-box-shadow: 0 0 5px -1px #63baff;
    --infi-key-fg: #fff;
    --infi-key-bg: #7d7d7d;
    --infi-checkbox-bg: #313233;
    --infi-checkbox-checked-bg: #424243;
    --infi-checkbox-border: #525354;
}

.rust .infi-root {
    --infi-fs-input-fg: var(--sidebar-fg);
    --infi-fs-input-bg: #29201d;
    --infi-fs-input-border: 2px solid #584d4a;
    --infi-fs-input-focus-border: 2px solid #4f95cc;
    --infi-fs-input-focus-box-shadow: 0 0 5px -1px #63baff;
}

.coal .infi-root {
    --infi-fs-input-bg: #1d1f21;
    --infi-fs-input-border: 2px solid #3e4144;
}

.navy .infi-root {
    --infi-fs-input-bg: #1e222f;
    --infi-fs-input-border: 2px solid #3d4252;
    --infi-sub-hover-bg: #242734;
}

.ayu .infi-root {
    --infi-fs-input-fg: var(--fg);
    --infi-fs-input-bg: #2b3035;
    --infi-fs-input-border: 2px solid #43474c;
    --infi-fs-input-focus-border: 2px solid #4f95cc;
    --infi-fs-input-focus-box-shadow: 0 0 5px -1px #63baff;
    --infi-sub-hover-bg: #282e35;
}

#infi-search {
    width: 100%;
    border-radius: 3px;
    box-sizing: border-box;
    padding: 10px 16px;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
}

#infi-search:focus:not(.infi-button-input) {
    box-shadow: 0 0 3px var(--searchbar-shadow-color);
}

#infi-search.infi-button-input {
    width: 100px;
}

#infi-search.infi-button-input::placeholder {
    position: relative;
    left: 14px;
}

#infi-search.infi-button-input:hover {
    transition: 0.3s ease-out;
    background: var(--infi-fs-button-input-bg) !important;
    outline: 2px solid var(--infi-fs-button-input-bg);
}

#infi-search.infi-button-input:hover::placeholder {
    color: var(--infi-fs-button-input-fg) !important;
}

@media print {
    #infi-search {
        display: none;
    }
}

#infisearch-mdbook-target {
    position: relative;
}

/*
 * For this plugin, don't show the controls until there is a query.
 */
#infisearch-mdbook-target.infi-empty-input > * {
    display: none;
}

.infi-root:not(.infi-fs-root) {
    display: block;
}

.light .infi-root .infi-title::after,
.rust .infi-root .infi-title::after,
.coal .infi-root .infi-title::after,
.navy .infi-root .infi-title::after,
.ayu .infi-root .infi-title::after {
    content: none;
    display: none;
}

.infi-header {
    padding-bottom: 9px;
}

.infi-load-more {
    padding: 7px 15px;
}
</style>
<p><input
    type="search"
    id="infi-search"
    placeholder="Search this book ..."
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div id="infisearch-mdbook-target"></div>
<h1 id="日志介绍"><a class="header" href="#日志介绍">日志介绍</a></h1>
<p>​	几乎每个大型应用程序都包含自己的日志记录或跟踪 API，the E.U. <a href="http://www.semper.org/">SEMPER</a> project  决定实现自己记录API、这是1996年初，经过无数次的改进、several incarnations 和大量工作，API 已经演变成 log4j，一个流行的 Java 日志记录包，该软件包是在 <a href="https://logging.apache.org/log4j/2.x/LICENSE">Apache 软件许可证</a>下分发的，</p>
<p>​	Apache 软件许可证是由<a href="http://www.opensource.org/">开源计划</a>认证的成熟的开源许可证。可以在 http://logging.apache.org/log4j/2.x/index.html 找到最新的 log4j 版本，包括完整的源代码、类文件和文档</p>
<p>​		将日志语句插入代码是一种低技术的调试方法。这也可能是唯一的方法，因为调试器并不总是可用的。这通常适用于多线程应用程序和整个分布式应用程序。</p>
<p>​		经验表明，日志记录是开发周期的重要组成部分。它提供了几个优点。</p>
<ol>
<li>它提供有关应用程序运行的精确上下文</li>
<li>一旦插入到代码中，日志输出的生成就不需要人工干预</li>
<li>此外，日志输出可以保存在持久性介质中，以备日后研究</li>
<li>除了在开发周期中使用之外，一个足够丰富的日志包也可以被视为一个审计工具</li>
</ol>
<h1 id="log4j-2介绍"><a class="header" href="#log4j-2介绍">Log4j 2介绍</a></h1>
<p>Log4j 1.x 已被广泛采用并用于许多应用程序。然而，多年来它的发展已经放缓。</p>
<p>由于需要兼容非常旧的 Java 版本，它变得更加难以维护，并于 2015 年 8 月终止。它的替代方案 SLF4J/Logback 对该框架进行了许多必要的改进。那么为什么要为 Log4j 2 烦恼呢？</p>
<ol>
<li>Log4j 2 旨在用作审计日志记录框架。 Log4j 1.x 和 Logback 在重新配置时都会丢失事件。 Log4j 2 不会。</li>
<li>Log4j 2 包含基于 <a href="https://lmax-exchange.github.io/disruptor/">LMAX Disruptor</a> 库的下一代异步记录器。在多线程场景中，异步 Logger 的吞吐量比 Log4j 1.x 和 Logback 高 10 倍，延迟低几个数量级。</li>
<li>Log4j 2 对于独立应用程序是 <a href="https://logging.apache.org/log4j/2.x/manual/garbagefree.html">garbage free</a>，在稳定状态日志记录期间对于 Web 应用程序来说是低垃圾。这减少了垃圾收集器的压力，并且可以提供更好的响应时间性能。</li>
<li>Log4j 2 使用<a href="https://logging.apache.org/log4j/2.x/manual/plugins.html">插件系统</a>，通过添加新的 <a href="https://logging.apache.org/log4j/2.x/manual/appenders.html">Appenders</a>, <a href="https://logging.apache.org/log4j/2.x/manual/filters.html">Filters</a>, <a href="https://logging.apache.org/log4j/2.x/manual/layouts.html">Layouts</a>, <a href="https://logging.apache.org/log4j/2.x/manual/lookups.html">Lookups</a>  and Pattern Converters ，无需对 Log4j 进行任何更改，就可以非常轻松地<a href="https://logging.apache.org/log4j/2.x/manual/extending.html">扩展框架</a>。</li>
<li>由于插件系统配置更简单。配置中的条目不需要指定类名。</li>
<li>支持<a href="https://logging.apache.org/log4j/2.x/manual/customloglevels.html">自定义日志级别</a>。自定义日志级别可以在代码或配置中定义。</li>
<li>支持 lambda 表达式。仅当启用了请求的日志级别时，在 Java 8 上运行的客户端代码才能使用 lambda 表达式来延迟构建日志消息。不需要显式级别检查，从而使代码更清晰。</li>
<li>支持<a href="https://logging.apache.org/log4j/2.x/manual/messages.html">消息对象</a>。消息允许通过日志系统传递有趣和复杂的结构并进行有效操作。 Users are free to create their own <a href="https://logging.apache.org/log4j/2.x/log4j-api/apidocs/org/apache/logging/log4j/message/Message.html">Message</a> types and write custom <a href="https://logging.apache.org/log4j/2.x/manual/layouts.html">Layouts</a>, <a href="https://logging.apache.org/log4j/2.x/manual/filters.html">Filters</a> and <a href="https://logging.apache.org/log4j/2.x/manual/lookups.html">Lookups</a> to manipulate them.</li>
<li>Log4j 1.x supports Filters on Appenders. Logback added TurboFilters to allow filtering of events before they are processed by a Logger. Log4j 2 supports Filters that can be configured to process events before they are handled by a Logger, as they are processed by a Logger or on an Appender.</li>
<li>大多数 Log4j 2 Appender 接受 Layout，允许以任何所需的格式传输数据。</li>
<li>Log4j 1.x 和 Logback 中的布局返回一个字符串。这导致了 Logback Encoders 中讨论的问题。 Log4j 2 采用更简单的方法，即 Layouts 总是返回一个字节数组。这样做的好处是，意味着它们几乎可以在任何 Appender 中使用，而不仅仅是写入 OutputStream Appender。</li>
<li>Syslog Appender 支持 TCP 和 UDP，并支持 BSD syslog 和 RFC 5424 格式。</li>
<li>Log4j 2 利用 Java 5 并发支持并在可能的最低级别执行锁定</li>
<li>它是一个 Apache 软件基金会项目，遵循所有 ASF 项目使用的社区和支持模型。如果您想贡献或获得提交更改的权利，只需遵循<a href="http://jakarta.apache.org/site/contributing.html">贡献</a>中概述的路径即可。</li>
</ol>
<h1 id="架构"><a class="header" href="#架构">架构</a></h1>
<p><img src="https://weisanju.github.io/note-service/java/images/log4j2-architecture.png" alt="image-20210817202907031" /></p>
<ol>
<li>使用 Log4j 2 API 的应用程序将从 LogManager 请求具有特定名称的 Logger。</li>
<li>LogManager 将定位适当的 LoggerContext，然后从中获取 Logger。</li>
<li>如果必须创建 Logger，它将与包含 a) 与 Logger 相同的名称，b) 父包的名称或 c) 根 LoggerConfig 的 LoggerConfig 相关联。</li>
<li>LoggerConfig 对象是从配置中的 Logger 声明创建的。</li>
<li>LoggerConfig 与实际交付 LogEvents 的 Appender 相关联。</li>
</ol>
<h2 id="logger-hierarchy"><a class="header" href="#logger-hierarchy">Logger Hierarchy</a></h2>
<p>在 Log4j 1.x 中，Logger Hierarchy 是通过 Logger 之间的关系维护的。在 Log4j 2 中，这种关系不再存在。</p>
<p>相反，层次结构在 LoggerConfig 对象之间的关系中维护。</p>
<p>Loggers 和 LoggerConfigs 是命名实体。 Logger 名称区分大小写，并遵循分层命名规则：</p>
<p><strong>Named Hierarchy</strong></p>
<ol>
<li>
<p>通过 点分命名</p>
</li>
<li>
<p>com.foo 是 com.foo.Bar 的祖先</p>
</li>
<li>
<p>根Config位于 LoggerConfig层级结构的顶部，它的特殊之处在于它始终存在并且它是每个层次结构的一部分</p>
</li>
<li>
<p>直接 获取 根LoggerConfig的Logger可以通过如下方式获取</p>
<pre><code class="language-java">Logger logger = LogManager.getLogger(LogManager.ROOT_LOGGER_NAME);
//或者
Logger logger = LogManager.getRootLogger();
</code></pre>
</li>
</ol>
<h2 id="loggercontext"><a class="header" href="#loggercontext">LoggerContext</a></h2>
<p>LoggerContext 作为 Logging 系统的锚点。但是，根据情况，应用程序中可能有多个活动的 LoggerContexts。</p>
<p>有关 LoggerContext 的更多详细信息，请参见日志分离部分</p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<p>每个 LoggerContext 都有一个活动配置。</p>
<p>配置包含所有 Appender、上下文范围的过滤器、LoggerConfig 并包含对 StrSubstitutor 的引用。</p>
<p>在重新配置期间，将存在两个 Configuration 对象。一旦所有记录器都被重定向到新配置，旧配置将被停止并丢弃。</p>
<h2 id="logger"><a class="header" href="#logger">Logger</a></h2>
<p>如前所述，Logger 是通过调用 LogManager.getLogger 创建的。</p>
<p>Logger 本身不执行任何直接操作。</p>
<p>它只有一个名称并与 LoggerConfig 相关联。</p>
<p>它扩展了 AbstractLogger 并实现了所需的方法。</p>
<p>随着配置被修改，Logger 可能会与不同的 LoggerConfig 相关联，从而导致它们的行为被修改。</p>
<h2 id="loggerconfig"><a class="header" href="#loggerconfig">LoggerConfig</a></h2>
<ol>
<li>LoggerConfig 对象是在日志配置中声明 Logger 时创建的。 LoggerConfig 包含一组过滤器，必须允许 LogEvent 在它被传递给任何 Appender 之前通过。它包含对应该用于处理事件的 Appender 集的引用。</li>
<li>oggerConfigs 将被分配一个日志级别。内置级别集包括 TRACE、DEBUG、INFO、WARN、ERROR 和 FATAL。 Log4j 2 还支持自定义日志级别。</li>
<li>另一种获得更多粒度的机制是改用标记。 Log4j 1.x 和 Logback 都有“级别继承”的概念。在 Log4j 2 中，Loggers 和 LoggerConfigs 是两个不同的对象，因此这个概念的实现方式不同。每个 Logger 引用适当的 LoggerConfig，后者又可以引用其父级，从而达到相同的效果</li>
</ol>
<p><strong>日志级别默认支持自动级别过滤</strong></p>
<p>横坐标是日志事件的级别、纵坐标是日志配置的级别</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Event Level</th><th style="text-align: left">LoggerConfig Level</th><th style="text-align: left"></th><th style="text-align: left"></th><th style="text-align: left"></th><th style="text-align: left"></th><th style="text-align: left"></th><th style="text-align: left"></th></tr></thead><tbody>
<tr><td style="text-align: left"></td><td style="text-align: left">TRACE</td><td style="text-align: left">DEBUG</td><td style="text-align: left">INFO</td><td style="text-align: left">WARN</td><td style="text-align: left">ERROR</td><td style="text-align: left">FATAL</td><td style="text-align: left">OFF</td></tr>
<tr><td style="text-align: left">ALL</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">NO</td></tr>
<tr><td style="text-align: left">TRACE</td><td style="text-align: left">YES</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td></tr>
<tr><td style="text-align: left">DEBUG</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td></tr>
<tr><td style="text-align: left">INFO</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td></tr>
<tr><td style="text-align: left">WARN</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td></tr>
<tr><td style="text-align: left">ERROR</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td></tr>
<tr><td style="text-align: left">FATAL</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">YES</td><td style="text-align: left">NO</td></tr>
<tr><td style="text-align: left">OFF</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td><td style="text-align: left">NO</td></tr>
</tbody></table>
</div>
<h2 id="filter"><a class="header" href="#filter">Filter</a></h2>
<p>除了上一节中描述的自动日志级别过滤之外，Log4j 还提供了过滤器，</p>
<ol>
<li>这些过滤器可以在控制传递给任何 LoggerConfig 之前，</li>
<li>在控制传递给 LoggerConfig 之后但在调用任何 Appenders 之前</li>
<li>在控制传递之后应用到 LoggerConfig 但在调用特定 Appender 之前，</li>
<li>以及在每个 Appender 上。</li>
</ol>
<p>以与防火墙过滤器非常相似的方式，每个过滤器可以返回三个结果之一，接受、拒绝或中立。</p>
<p>Accept, Deny or Neutral</p>
<ul>
<li>
<p>Accept 的响应意味着不应调用其他过滤器并且事件应该进行。</p>
</li>
<li>
<p>拒绝响应意味着应立即忽略该事件并将控制权返回给调用者。</p>
</li>
<li>
<p>Neutral 响应表示该事件应传递给其他过滤器。</p>
</li>
</ul>
<p>如果没有其他过滤器，则将处理该事件。</p>
<h2 id="appender"><a class="header" href="#appender">Appender</a></h2>
<p>目前，存在用于控制台、文件、远程套接字服务器、Apache Flume、JMS、远程 UNIX Syslog 守护进程和各种数据库 API 的附加程序。</p>
<p>有关可用的各种类型的更多详细信息，请参阅 Appenders 部分。一个 Logger 可以附加多个 Appender。可以通过调用当前 Configuration 的 addLoggerAppender 方法将 Appender 添加到 Logger。如果与 Logger 名称匹配的 LoggerConfig 不存在，则将创建一个，将 Appender 附加到它，然后将通知所有 Loggers 更新它们的 LoggerConfig 引用。</p>
<p><strong>appender可加性原则</strong></p>
<p>给定记录器的每个启用的日志记录请求都将转发到该 Logger 的 LoggerConfig 中的所有 appender 以及 LoggerConfig 父级的 Appender。</p>
<p>换句话说，Appender 从 LoggerConfig 层次结构中附加地继承。</p>
<p>例如，如果将控制台 appender 添加到根记录器，则所有启用的日志记录请求至少会在控制台上打印。</p>
<p>如果另外将文件附加程序添加到 LoggerConfig，例如 C，则为 C 和 C 的子项启用的日志记录请求将打印在文件和控制台上。</p>
<p>可以通过在配置文件中的 Logger 声明中设置 additivity="false" 来覆盖此默认行为，以便 Appender 累积不再是可加的。</p>
<p>下面总结了管理 appender 可加性的规则。</p>
<p><strong>L 的一条日志语句的输出将转到与 L 关联的 LoggerConfig 中的所有 Appender 以及该 LoggerConfig 的祖先。</strong></p>
<p>这就是术语“appender 可加性”的含义。</p>
<p>但是，如果与 Logger L 关联的 LoggerConfig 的祖先，例如 P，将可加性标志设置为 false，那么 L 的输出将被定向到 L 的 LoggerConfig 中的所有 appender，并且它的祖先一直到并包括 P，但不包括在</p>
<p>The table below shows an example:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Logger Name</th><th style="text-align: left">Added Appenders</th><th style="text-align: left">Additivity Flag</th><th style="text-align: left">Output Targets</th><th style="text-align: left">Comment</th></tr></thead><tbody>
<tr><td style="text-align: left">root</td><td style="text-align: left">A1</td><td style="text-align: left">not applicable</td><td style="text-align: left">A1</td><td style="text-align: left">The root logger has no parent so additivity does not apply to it.</td></tr>
<tr><td style="text-align: left">x</td><td style="text-align: left">A-x1, A-x2</td><td style="text-align: left">true</td><td style="text-align: left">A1, A-x1, A-x2</td><td style="text-align: left">Appenders of "x" and root.</td></tr>
<tr><td style="text-align: left">x.y</td><td style="text-align: left">none</td><td style="text-align: left">true</td><td style="text-align: left">A1, A-x1, A-x2</td><td style="text-align: left">Appenders of "x" and root. It would not be typical to configure a Logger with no Appenders.</td></tr>
<tr><td style="text-align: left">x.y.z</td><td style="text-align: left">A-xyz1</td><td style="text-align: left">true</td><td style="text-align: left">A1, A-x1, A-x2, A-xyz1</td><td style="text-align: left">Appenders in "x.y.z", "x" and root.</td></tr>
<tr><td style="text-align: left">security</td><td style="text-align: left">A-sec</td><td style="text-align: left">false</td><td style="text-align: left">A-sec</td><td style="text-align: left">No appender accumulation since the additivity flag is set to false.</td></tr>
<tr><td style="text-align: left">security.access</td><td style="text-align: left">none</td><td style="text-align: left">true</td><td style="text-align: left">A-sec</td><td style="text-align: left">Only appenders of "security" because the additivity flag in "security" is set to false.</td></tr>
</tbody></table>
</div>
<h2 id="layout"><a class="header" href="#layout">Layout</a></h2>
<p>通常情况下，用户不仅希望自定义输出目的地，还希望自定义输出格式。</p>
<p>这是通过将 Layout 与 Appender 相关联来实现的。</p>
<p>Layout 负责根据用户的意愿格式化 LogEvent，而 appender 负责将格式化的输出发送到其目的地。</p>
<p>PatternLayout 是标准 log4j 发行版的一部分，它允许用户根据类似于 C 语言 printf 函数的转换模式来指定输出格式。</p>
<p>例如，具有转换模式“%r [%t] %-5p %c - %m%n”的 PatternLayout 将输出类似于：</p>
<pre><code>176 [main] INFO  org.foo.Bar - Located nearest gas station.
</code></pre>
<p>第一个字段是自程序启动以来经过的毫秒数。</p>
<p>第二个字段是发出日志请求的线程。</p>
<p>第三个字段是日志语句的级别。</p>
<p>第四个字段是与日志请求关联的记录器的名称。</p>
<p>“-”后面的文字是语句的信息。</p>
<p>Log4j 为各种用例提供了许多不同的布局，例如 JSON、XML、HTML 和 Syslog（包括新的 RFC 5424 版本）。</p>
<p>其他附加程序（例如数据库连接器）填充指定的字段而不是特定的文本布局。</p>
<p>同样重要的是，log4j 将根据用户指定的标准呈现日志消息的内容。</p>
<p>例如，如果您经常需要记录当前项目中使用的对象类型 Oranges，那么您可以创建一个接受 Orange 实例的 OrangeMessage 并将其传递给 Log4j，以便在以下情况下可以将 Orange 对象格式化为适当的字节数组</p>
<h2 id="strsubstitutor-and-strlookup"><a class="header" href="#strsubstitutor-and-strlookup">StrSubstitutor and StrLookup</a></h2>
<p>StrSubstitutor 类和 StrLookup 接口是从 Apache Commons Lang 借来的，然后经过修改以支持评估 LogEvents。</p>
<p>此外，Interpolator 类是从 Apache Commons Configuration 借来的，以允许 StrSubstitutor 评估来自多个 StrLookups 的变量。</p>
<p>它也经过修改以支持评估 LogEvents。</p>
<p>这些共同提供了一种机制，允许配置引用来自系统属性、配置文件、ThreadContext Map、LogEvent 中的 StructuredData 的变量。</p>
<p>如果组件能够处理它，则可以在处理配置时或在处理每个事件时解析变量。</p>
<p>有关详细信息，请参阅查找。</p>
<script src="/note-service/java/infisearch_assets/search-ui.chinese.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/note-service/java/infisearch_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/note-service/java/';
const mode = 'target';
infisearch.init({
  searcherOptions: {
    url: base_url + 'infisearch_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('infisearch-mdbook-target'),
    fsButtonPlaceholder: 'Search',
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      searchedTermsParam: 'search',
    },
    multiSelectFilters: [
      { fieldName: 'partTitle', displayName: 'Section', defaultOptName: 'None' },
    ],
  },
});

document.getElementById('infi-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script>
<p><span data-infisearch-part-title="未分类"></span></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../19.日志/JUL.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../19.日志/log4j2/Log4j2API.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../19.日志/JUL.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../19.日志/log4j2/Log4j2API.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
