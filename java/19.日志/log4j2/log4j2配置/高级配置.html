<!DOCTYPE HTML>
<html lang="zh_CN" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>高级配置.md - JAVA笔记库</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">JAVA笔记库</h1>

                    <div class="right-buttons">

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="/note-service/java/infisearch_assets/search-ui-light.css">
<style>.light .infi-root,
.rust .infi-root,
.coal .infi-root,
.navy .infi-root,
.ayu .infi-root {
    --infi-shadow: none;
    --infi-border: 3px solid var(--table-header-bg);
    --infi-bg: var(--bg);
    --infi-triangle-bg: var(--table-header-bg);
    --infi-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --infi-title-fg: var(--fg);
    --infi-title-hover-fg: var(--fg);
    --infi-title-hover-bg: var(--table-header-bg);
    --infi-title-border-bottom-hover: 2px solid var(--table-header-bg);
    --infi-heading-fg: var(--fg);
    --infi-heading-hover-fg: var(--fg);
    --infi-body-fg: var(--fg);
    --infi-body-hover-fg: var(--fg);
    --infi-sub-bg: var(--bg);
    --infi-highlight: var(--search-mark-bg);
    --infi-highlight-bg: none;
    --infi-header-fg: var(--fg);
    --infi-checkbox-bg: #f8f8f8;
    --infi-checkbox-checked-bg: #fff;
    --infi-checkbox-border: #414141;
    --infi-filter-header-active: var(--infi-title-bg);
    --infi-error-fg: var(--fg);
    --infi-fine-print-fg: var(--fg);
    --infi-loading-bg: var(--fg);
    --infi-loading-secondary-bg: var(--fg);
    --infi-load-more-fg: var(--infi-title-fg);
    --infi-load-more-bg: var(--infi-title-bg);
    --infi-load-more-hover-fg: var(--infi-title-hover-fg);
    --infi-load-more-hover-bg: var(--infi-title-hover-bg);
    --infi-scrollbar-bg: none;
    --infi-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --infi-fs-button-input-fg: var(--searchbar-shadow-color);
    --infi-fs-border: 3px solid var(--sidebar-bg);
    --infi-fs-box-shadow: none;
    --infi-fs-header-bg: var(--sidebar-bg);
    --infi-fs-header-box-shadow: none;
    --infi-tip-table-header-border: var(--table-border-color);
    --infi-tip-table-border: transparent;
    --infi-tip-table-alternate: var(--table-alternate-bg);
    --infi-tip-bg: var(--sidebar-bg);
    --infi-tip-fg: var(--sidebar-fg);
    --infi-tip-code-fg: var(--inline-code-color);
    --infi-tip-code-bg: transparent;
    --infi-tip-icon-bg: rgb(230, 230, 230);
    --infi-tip-icon-fg: rgb(80, 80, 80);
}

.light .infi-root {
    --infi-fs-header-close-fg: var(--searchresults-header-fg);
    --infi-fs-header-close-hover-fg: var(--fg);
}

.ayu .infi-root,
.rust .infi-root,
.coal .infi-root,
.navy .infi-root {
    --infi-fs-header-close-fg: var(--sidebar-fg);
    --infi-fs-header-close-hover-fg: white;
}

.ayu .infi-root,
.rust .infi-root {
    --infi-tip-code-fg: var(--search-mark-bg) !important;
    --infi-tip-icon-bg: rgb(200, 200, 200);
    --infi-tip-icon-fg: rgb(50, 50, 50);
}

.light .infi-root .infi-list-item.focus,
.rust .infi-root .infi-list-item.focus,
.coal .infi-root .infi-list-item.focus,
.navy .infi-root .infi-list-item.focus,
.ayu .infi-root .infi-list-item.focus {
    outline: 2px solid grey;
}

.light .infi-root,
.coal .infi-root,
.navy .infi-root,
.ayu .infi-root {
    --infi-title-bg: var(--theme-hover);
    --infi-sub-hover-bg: var(--table-alternate-bg);
    --infi-title-border-bottom: 2px solid var(--theme-hover);
}

.light .infi-root {
    --infi-highlight: #82a6c4;
    --infi-sub-hover-bg: #ebebeb;
}

.rust .infi-root {
    --infi-highlight: #bc8e6a;

    --infi-tip-table-alternate: var(--sidebar-bg);
    --infi-title-bg: var(--table-header-bg);
    --infi-title-border-bottom: 2px solid var(--table-header-bg);

    --infi-sub-hover-bg: #c6bbb1;
    --infi-title-bg: #bbada1;
    --infi-title-border-bottom: 2px solid #bbada1;
    --infi-title-hover-fg: #000;
    --infi-title-hover-bg: #a19488;
    --infi-title-border-bottom-hover: 2px solid #a19488;
    --infi-body-hover-fg: #1e1e1e;
    --infi-heading-hover-fg: #1e1e1e;
}

.coal .infi-root {
    --infi-highlight: #496c8a;
    --infi-sub-hover-bg: #272a2b;
}

.infi-theme .infi-root .infi-tip-item code,
.rust .infi-root .infi-tip-item code {
    color: var(--infi-tip-code-fg) !important;;
}

.coal .infi-root,
.navy .infi-root,
.ayu .infi-root {
    --infi-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
    --infi-fs-input-fg: var(--fg);
    --infi-fs-input-focus-border: 2px solid #4f95cc;
    --infi-fs-input-focus-box-shadow: 0 0 5px -1px #63baff;
    --infi-key-fg: #fff;
    --infi-key-bg: #7d7d7d;
    --infi-checkbox-bg: #313233;
    --infi-checkbox-checked-bg: #424243;
    --infi-checkbox-border: #525354;
}

.rust .infi-root {
    --infi-fs-input-fg: var(--sidebar-fg);
    --infi-fs-input-bg: #29201d;
    --infi-fs-input-border: 2px solid #584d4a;
    --infi-fs-input-focus-border: 2px solid #4f95cc;
    --infi-fs-input-focus-box-shadow: 0 0 5px -1px #63baff;
}

.coal .infi-root {
    --infi-fs-input-bg: #1d1f21;
    --infi-fs-input-border: 2px solid #3e4144;
}

.navy .infi-root {
    --infi-fs-input-bg: #1e222f;
    --infi-fs-input-border: 2px solid #3d4252;
    --infi-sub-hover-bg: #242734;
}

.ayu .infi-root {
    --infi-fs-input-fg: var(--fg);
    --infi-fs-input-bg: #2b3035;
    --infi-fs-input-border: 2px solid #43474c;
    --infi-fs-input-focus-border: 2px solid #4f95cc;
    --infi-fs-input-focus-box-shadow: 0 0 5px -1px #63baff;
    --infi-sub-hover-bg: #282e35;
}

#infi-search {
    width: 100%;
    border-radius: 3px;
    box-sizing: border-box;
    padding: 10px 16px;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
}

#infi-search:focus:not(.infi-button-input) {
    box-shadow: 0 0 3px var(--searchbar-shadow-color);
}

#infi-search.infi-button-input {
    width: 100px;
}

#infi-search.infi-button-input::placeholder {
    position: relative;
    left: 14px;
}

#infi-search.infi-button-input:hover {
    transition: 0.3s ease-out;
    background: var(--infi-fs-button-input-bg) !important;
    outline: 2px solid var(--infi-fs-button-input-bg);
}

#infi-search.infi-button-input:hover::placeholder {
    color: var(--infi-fs-button-input-fg) !important;
}

@media print {
    #infi-search {
        display: none;
    }
}

#infisearch-mdbook-target {
    position: relative;
}

/*
 * For this plugin, don't show the controls until there is a query.
 */
#infisearch-mdbook-target.infi-empty-input > * {
    display: none;
}

.infi-root:not(.infi-fs-root) {
    display: block;
}

.light .infi-root .infi-title::after,
.rust .infi-root .infi-title::after,
.coal .infi-root .infi-title::after,
.navy .infi-root .infi-title::after,
.ayu .infi-root .infi-title::after {
    content: none;
    display: none;
}

.infi-header {
    padding-bottom: 9px;
}

.infi-load-more {
    padding: 7px 15px;
}
</style>
<p><input
    type="search"
    id="infi-search"
    placeholder="Search this book ..."
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div id="infisearch-mdbook-target"></div>
<h1 id="scripts"><a class="header" href="#scripts">Scripts</a></h1>
<p>Log4j 支持在其某些组件中使用 JSR 223 脚本语言。</p>
<p>可以使用任何为 <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/scripting/">JSR 223</a> 脚本引擎提供支持的语言。</p>
<p>可以在脚本引擎网站上找到语言和它们的绑定列表。</p>
<p>但是，其中列出的一些语言（例如 JavaScript、Groovy 和 Beanshell）直接支持 JSR 223 脚本框架，并且只需要安装该语言的 jar。</p>
<p>The components that support using scripts do so by allowing a <code>&lt;script&gt;</code>, <code>&lt;scriptFile&gt;</code>, or <code>&lt;scriptRef&gt;</code> element to be configured on them</p>
<ol>
<li>
<p>script元素包含脚本名称、脚本语言和脚本文本。</p>
</li>
<li>
<p>scriptFile 元素包含脚本的名称、位置、语言、字符集以及是否应监视文件的更改。</p>
</li>
<li>
<p>scriptRef 元素包含在 配置元素中定义的脚本的名称</p>
</li>
<li>
<p>脚本的名称用于存储脚本及其 ScriptEngine，因此每次需要运行脚本时都可以快速定位</p>
</li>
<li>
<p>虽然名称不是必需的，但提供它有助于在脚本运行时调试问题。</p>
</li>
<li>
<p>必须在脚本元素上提供语言，并且必须指定出现在配置状态日志中的语言名称之一，如下一节所述</p>
</li>
<li>
<p>如果未在 scriptFile 元素上指定语言，则语言将由脚本路径的文件扩展名确定</p>
</li>
<li>
<p>如果请求文件监视，则只有在配置元素上指定了非零的 monitorInterval 时才会启用它。该间隔将用于检查文件中的更改。</p>
</li>
</ol>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Configuration status="debug" name="RoutingTest"&gt;
  &lt;Scripts&gt;
    &lt;Script name="selector" language="javascript"&gt;&lt;![CDATA[
            var result;
            if (logEvent.getLoggerName().equals("JavascriptNoLocation")) {
                result = "NoLocation";
            } else if (logEvent.getMarker() != null &amp;&amp; logEvent.getMarker().isInstanceOf("FLOW")) {
                result = "Flow";
            }
            result;
            ]]&gt;&lt;/Script&gt;
    &lt;ScriptFile name="groovy.filter" path="scripts/filter.groovy"/&gt;
  &lt;/Scripts&gt;
 
  &lt;Appenders&gt;
    &lt;Console name="STDOUT"&gt;
      &lt;ScriptPatternSelector defaultPattern="%d %p %m%n"&gt;
        &lt;ScriptRef ref="selector"/&gt;
          &lt;PatternMatch key="NoLocation" pattern="[%-5level] %c{1.} %msg%n"/&gt;
          &lt;PatternMatch key="Flow" pattern="[%-5level] %c{1.} ====== %C{1.}.%M:%L %msg ======%n"/&gt;
      &lt;/ScriptPatternSelector&gt;
      &lt;PatternLayout pattern="%m%n"/&gt;
    &lt;/Console&gt;
  &lt;/Appenders&gt;
 
  &lt;Loggers&gt;
    &lt;Logger name="EventLogger" level="info" additivity="false"&gt;
        &lt;ScriptFilter onMatch="ACCEPT" onMisMatch="DENY"&gt;
          &lt;Script name="GroovyFilter" language="groovy"&gt;&lt;![CDATA[
            if (logEvent.getMarker() != null &amp;&amp; logEvent.getMarker().isInstanceOf("FLOW")) {
                return true;
            } else if (logEvent.getContextMap().containsKey("UserId")) {
                return true;
            }
            return false;
            ]]&gt;
          &lt;/Script&gt;
        &lt;/ScriptFilter&gt;
      &lt;AppenderRef ref="STDOUT"/&gt;
    &lt;/Logger&gt;
 
    &lt;Root level="error"&gt;
      &lt;ScriptFilter onMatch="ACCEPT" onMisMatch="DENY"&gt;
        &lt;ScriptRef ref="groovy.filter"/&gt;
      &lt;/ScriptFilter&gt;
      &lt;AppenderRef ref="STDOUT"/&gt;
    &lt;/Root&gt;
  &lt;/Loggers&gt;
 
&lt;/Configuration&gt;
</code></pre>
<p>如果 Configuration 元素上的 status 属性设置为 DEBUG，则会列出当前安装的脚本引擎列表及其属性。</p>
<p>尽管有些引擎可能会说它们不是线程安全的，但如果引擎通告它不是线程安全的，Log4j 会采取措施确保脚本以线程安全的方式运行。</p>
<p>当脚本被执行时，它们将被提供一组变量，这些变量应该允许它们完成预期执行的任何任务。</p>
<p>有关脚本可用的变量列表，请参阅各个组件的文档。</p>
<p>支持脚本编写的组件期望将返回值传递回调用 Java 代码。</p>
<p>这对于一些脚本语言来说不是问题，但 Javascript 不允许 return 语句，除非它在函数内。</p>
<p>但是，Javascript 将返回脚本中执行的最后一条语句的值。</p>
<p>因此，如下所示的代码将导致所需的行为。</p>
<pre><code class="language-js">       var result;
            if (logEvent.getLoggerName().equals("JavascriptNoLocation")) {
                result = "NoLocation";
            } else if (logEvent.getMarker() != null &amp;&amp; logEvent.getMarker().isInstanceOf("FLOW")) {
                result = "Flow";
            }
            result;
</code></pre>
<h1 id="xinclude"><a class="header" href="#xinclude">XInclude</a></h1>
<p>XML 配置文件可以包含其他带有 XInclude 的文件。</p>
<p>这是一个示例 log4j2.xml 文件，其中包含另外两个文件：</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration xmlns:xi="http://www.w3.org/2001/XInclude"
               status="warn" name="XIncludeDemo"&gt;
  &lt;properties&gt;
    &lt;property name="filename"&gt;xinclude-demo.log&lt;/property&gt;
  &lt;/properties&gt;
  &lt;ThresholdFilter level="debug"/&gt;
  &lt;xi:include href="log4j-xinclude-appenders.xml" /&gt;
  &lt;xi:include href="log4j-xinclude-loggers.xml" /&gt;
&lt;/configuration&gt;
</code></pre>
<p><strong>log4j-xinclude-appenders.xml</strong></p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;appenders&gt;
  &lt;Console name="STDOUT"&gt;
    &lt;PatternLayout pattern="%m%n" /&gt;
  &lt;/Console&gt;
  &lt;File name="File" fileName="${filename}" bufferedIO="true" immediateFlush="true"&gt;
    &lt;PatternLayout&gt;
      &lt;pattern&gt;%d %p %C{1.} [%t] %m%n&lt;/pattern&gt;
    &lt;/PatternLayout&gt;
  &lt;/File&gt;
&lt;/appenders&gt;
</code></pre>
<p>log4j-xinclude-loggers.xml:</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;loggers&gt;  &lt;logger name="org.apache.logging.log4j.test1" level="debug" additivity="false"&gt;    &lt;ThreadContextMapFilter&gt;      &lt;KeyValuePair key="test" value="123" /&gt;    &lt;/ThreadContextMapFilter&gt;    &lt;AppenderRef ref="STDOUT" /&gt;  &lt;/logger&gt;   &lt;logger name="org.apache.logging.log4j.test2" level="debug" additivity="false"&gt;    &lt;AppenderRef ref="File" /&gt;  &lt;/logger&gt;   &lt;root level="error"&gt;    &lt;AppenderRef ref="STDOUT" /&gt;  &lt;/root&gt;&lt;/loggers&gt;
</code></pre>
<h1 id="composite-configuration"><a class="header" href="#composite-configuration">Composite Configuration</a></h1>
<p>Log4j 允许使用多个配置文件，方法是在 log4j.configurationFile 上将它们指定为逗号分隔的文件路径列表，或者在使用 url 时，通过添加辅助配置位置作为名为“override”的查询参数。</p>
<p>可以通过在 log4j.mergeStrategy 属性上指定实现 MergeStrategy 接口的类来控制合并逻辑。</p>
<p>默认合并策略将使用以下规则合并文件：</p>
<ol>
<li>
<p>全局配置属性与后面配置中的属性聚合，替换以前配置中的属性，但以下情况除外</p>
<ul>
<li>将使用最高状态级别</li>
<li>将使用大于 0 的最低 monitorInterval</li>
<li>packages are joined with comma</li>
</ul>
</li>
<li>
<p>汇总所有配置的属性.重复的属性替换了以前配置中的属性</p>
</li>
<li>
<p>如果定义了多个过滤器，则过滤器将在 CompositeFilter 下聚合。由于过滤器未命名，因此可能存在重复项。</p>
</li>
<li>
<p>脚本和脚本文件引用被聚合。重复的定义取代了先前配置中的定义.</p>
</li>
<li>
<p>Appender 是聚合的。具有相同名称的 Appender 被后面的配置中的 Appender 替换，包括 Appender 的所有子组件</p>
</li>
<li>
<p>记录器都是聚合的。记录器属性单独合并，重复项被后续配置中的那些属性替换。</p>
<p>Logger 上的 Appender 引用被聚合，重复项被后面的配置中的那些替换。如果定义了多个过滤器，则 Logger 上的过滤器将在 CompositeFilter 下聚合。由于过滤器未命名，因此可能存在重复项。包含或丢弃 Appender 引用下的过滤器取决于是保留还是丢弃其父 Appender 引用。</p>
</li>
</ol>
<h1 id="status-messages"><a class="header" href="#status-messages">Status Messages</a></h1>
<p><strong>Troubleshooting tip for the impatient:</strong></p>
<p>从 log4j-2.9 开始，如果定义了系统属性 log4j2.debug（具有任何值或没有值），log4j2 会将所有内部日志记录打印到控制台。</p>
<p>在 log4j-2.9 之前，有两个地方可以控制内部日志记录：</p>
<ol>
<li>
<p>在找到配置之前，可以使用系统属性 org.apache.logging.log4j.simplelog.StatusLogger.level 控制状态记录器级别。</p>
</li>
<li>
<p>找到配置后，可以在配置文件中使用“status”属性控制状态记录器级别，例如：<code>&lt;Configuration status="trace"&gt;.</code></p>
</li>
</ol>
<p>正如希望能够诊断应用程序中的问题一样，经常需要能够诊断日志配置或已配置组件中的问题。</p>
<p>由于尚未配置日志记录，因此在初始化期间无法使用“正常”日志记录。</p>
<p>此外，appender 中的正常日志记录可能会创建无限递归，Log4j 将检测到该递归并导致递归事件被忽略。</p>
<p>为了满足这种需求，Log4j 2 API 包含一个 StatusLogger。</p>
<pre><code class="language-java">protected final static Logger logger = StatusLogger.getLogger();
</code></pre>
<p>由于 StatusLogger 实现了 Log4j 2 API 的 Logger 接口，因此可以使用所有正常的 Logger 方法。</p>
<p>在配置 Log4j 时，有时需要查看生成的状态事件。</p>
<p>这可以通过将 status 属性添加到配置元素来完成，或者可以通过设置“Log4jDefaultStatusLevel”系统属性来提供默认值。</p>
<p>status 属性的有效值为“trace”、“debug”、“info”、“warn”、“error”和“fatal”。</p>
<h1 id="testing-in-maven"><a class="header" href="#testing-in-maven">Testing in Maven</a></h1>
<p>Maven 可以在构建周期中运行单元和功能测试。</p>
<p>默认情况下，放置在 src/test/resources 中的任何文件都会自动复制到 target/test-classes 并在执行任何测试期间包含在类路径中。</p>
<p>因此，将 log4j2-test.xml 放入此目录将导致使用它而不是可能存在的 log4j2.xml 或 log4j2.json。</p>
<p>因此，在测试期间可以使用不同于生产中使用的日志配置。</p>
<p>Log4j 2 广泛使用的第二种方法是在 junit 测试类中用 @BeforeClass 注释的方法中设置 log4j.configurationFile 属性。</p>
<p>这将允许在测试期间使用任意命名的文件。</p>
<p>Log4j 2 也广泛使用的第三种方法是使用 LoggerContextRule JUnit 测试规则，它为测试提供了额外的便利方法。</p>
<p>这需要将 log4j-core test-jar 依赖项添加到您的测试范围依赖项中。</p>
<pre><code class="language-java">public class AwesomeTest {
    @Rule
    public LoggerContextRule init = new LoggerContextRule("MyTestConfig.xml");
 
    @Test
    public void testSomeAwesomeFeature() {
        final LoggerContext ctx = init.getLoggerContext();
        final Logger logger = init.getLogger("org.apache.logging.log4j.my.awesome.test.logger");
        final Configuration cfg = init.getConfiguration();
        final ListAppender app = init.getListAppender("List");
        logger.warn("Test message");
        final List&lt;LogEvent&gt; events = app.getEvents();
        // etc.
    }
}
</code></pre>
<h1 id="system-properties"><a class="header" href="#system-properties">System Properties</a></h1>
<p>Log4j 文档引用了许多系统属性，可用于控制 Log4j 2 行为的各个方面。</p>
<p>下表列出了这些属性以及它们的默认值和它们控制的内容的描述。</p>
<p>属性名称中存在的任何空格都用于视觉流，应删除。</p>
<p>请注意，从 Log4j 2.10 开始，所有系统属性名称都已规范化以遵循一致的命名方案。</p>
<p>虽然仍支持旧的属性名称以实现向后兼容性，但建议更新配置以使用新样式。</p>
<p>该系统是可扩展的，并通过 PropertySource 接口启用。</p>
<p>可以通过 Java SE 中的标准 ServiceLoader 机制添加其他属性源类。</p>
<p>属性可以被优先级较低的源覆盖（例如，-100 在 100 之前）。</p>
<p>默认情况下，以下来源都是可用的：</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Source</th><th style="text-align: left">Priority</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">Environment Variables</td><td style="text-align: left">-100</td><td style="text-align: left">环境变量都以LOG4J_为前缀，全部大写，单词之间用下划线分隔。只有这个命名方案支持环境变量，因为没有旧的命名方案来保持兼容性。</td></tr>
<tr><td style="text-align: left">log4j2.component.properties file</td><td style="text-align: left">0</td><td style="text-align: left">在类路径中包含此文件可用作提供属性作为系统属性的替代方法。这优先于系统属性，但它们可以被如上所述的环境变量覆盖。</td></tr>
<tr><td style="text-align: left">System Properties</td><td style="text-align: left">100</td><td style="text-align: left">所有属性都可以使用正常的系统属性模式设置。<br/><br/>它们具有最低优先级，可以被包含的属性文件或环境变量覆盖。</td></tr>
</tbody></table>
</div>
<p>以下是可用全局配置属性的列表。</p>
<p>请注意，与配置文件中可用的配置设置不同，这些只能为每个 JVM 进程设置一次。</p>
<p>属性名称列包含在属性文件和系统属性中使用的名称；</p>
<p>Environemt Variable 为等效的环境变量；</p>
<p>和 2.10 之前的名称的旧属性名称。</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Property Name (Legacy Property Name)</th><th style="text-align: left">Environment Variable</th><th style="text-align: left">Default Value</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">log4j2.configurationFile (log4j.configurationFile)</td><td style="text-align: left">LOG4J_CONFIGURATION_FILE</td><td style="text-align: left">Log4j 2 配置文件的路径。<br/>还可能包含逗号分隔的配置文件名列表。可能包含一个 URL。<br/><br/>当指定为 URL 时，“覆盖”查询参数可用于指定其他配置文件位置。</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">log4j2.debug (log4j2.debug)</td><td style="text-align: left">LOG4J_DEBUG</td><td style="text-align: left"></td><td style="text-align: left">Log4j2 will print all internal logging to the console if system property log4j2.debug is defined (with any or no value).</td></tr>
<tr><td style="text-align: left">log4j2.mergeStrategy (log4j.mergeStrategy)</td><td style="text-align: left">LOG4J_MERGE_STRATEGY</td><td style="text-align: left"></td><td style="text-align: left">The name of the class that implements the MergeStrategy interface. If not specified DefaultMergeStrategy will be used when creating a CompositeConfiguration..</td></tr>
<tr><td style="text-align: left">log4j2.contextSelector (Log4jContextSelector)</td><td style="text-align: left">LOG4J_CONTEXT_SELECTOR</td><td style="text-align: left">ClassLoaderContextSelector</td><td style="text-align: left">Creates the LoggerContexts. An application can have one or more active LoggerContexts depending on the circumstances. See <a href="https://logging.apache.org/log4j/2.x/manual/logsep.html">Log Separation</a> for more details. Available context selector implementation classes: org.apache.logging.log4j.core.async .AsyncLoggerContextSelector - makes <a href="https://logging.apache.org/log4j/2.x/manual/async.html">all loggers asynchronous</a>. org.apache.logging.log4j.core.selector .BasicContextSelector - creates a single shared LoggerContext. org.apache.logging.log4j.core.selector .ClassLoaderContextSelector - separate LoggerContexts for each web application. org.apache.logging.log4j.core.selector .JndiContextSelector - use JNDI to locate each web application's LoggerContext. org.apache.logging.log4j.core.osgi .BundleContextSelector - separate LoggerContexts for each OSGi bundle.</td></tr>
<tr><td style="text-align: left">log4j2.logEventFactory (Log4jLogEventFactory)</td><td style="text-align: left">LOG4J_LOG_EVENT_FACTORY</td><td style="text-align: left">org.apache.logging.log4j.core.impl .DefaultLogEventFactory</td><td style="text-align: left">Factory class used by LoggerConfig to create LogEvent instances. (Ignored when the AsyncLoggerContextSelector is used.)</td></tr>
<tr><td style="text-align: left">log4j2.loggerContextFactory (log4j2.loggerContextFactory)</td><td style="text-align: left">LOG4J_LOGGER_CONTEXT_FACTORY</td><td style="text-align: left">org.apache.logging.log4j.simple .SimpleLoggerContextFactory</td><td style="text-align: left">Factory class used by LogManager to bootstrap the logging implementation. The core jar provides org.apache.logging.log4j.core .impl.Log4jContextFactory.</td></tr>
<tr><td style="text-align: left">log4j2.configurationFactory (log4j.configurationFactory)</td><td style="text-align: left">LOG4J_CONFIGURATION_FACTORY</td><td style="text-align: left"></td><td style="text-align: left">Fully specified class name of a class extending org.apache.logging.log4j.core .config.ConfigurationFactory. If specified, an instance of this class is added to the list of configuration factories.</td></tr>
<tr><td style="text-align: left">log4j2.shutdownHookEnabled (log4j.shutdownHookEnabled)</td><td style="text-align: left">LOG4J_SHUTDOWN_<br />HOOK_ENABLED</td><td style="text-align: left">true</td><td style="text-align: left">Overrides the global flag for whether or not a shutdown hook should be used to stop a LoggerContext. By default, this is enabled and can be disabled on a per-configuration basis. When running with the log4j-web module, this is automatically disabled.</td></tr>
<tr><td style="text-align: left">log4j2.shutdownCallbackRegistry (log4j.shutdownCallbackRegistry)</td><td style="text-align: left">LOG4J_SHUTDOWN_<br />CALLBACK_REGISTRY</td><td style="text-align: left">org.apache.logging.log4j.core.util .DefaultShutdownCallbackRegistry</td><td style="text-align: left">Fully specified class name of a class implementing <a href="https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/util/ShutdownCallbackRegistry.html">ShutdownCallbackRegistry</a>. If specified, an instance of this class is used instead of DefaultShutdownCallbackRegistry. The specified class must have a default constructor.</td></tr>
<tr><td style="text-align: left">log4j2.clock (log4j.Clock)</td><td style="text-align: left">LOG4J_CLOCK</td><td style="text-align: left">SystemClock</td><td style="text-align: left">Implementation of the org.apache.logging.log4j .core.util.Clock interface that is used for timestamping the log events. By default, System.currentTimeMillis is called on every log event. You can also specify a fully qualified class name of a custom class that implements the Clock interface.</td></tr>
<tr><td style="text-align: left">log4j2.level (org.apache.logging.log4j.level)</td><td style="text-align: left">LOG4J_LEVEL</td><td style="text-align: left">ERROR</td><td style="text-align: left">Log level of the default configuration. The default configuration is used if the ConfigurationFactory could not successfully create a configuration (e.g. no log4j2.xml file was found).</td></tr>
<tr><td style="text-align: left">log4j2.disableThreadContext (disableThreadContext)</td><td style="text-align: left">LOG4J_DISABLE_<br />THREAD_CONTEXT</td><td style="text-align: left">false</td><td style="text-align: left">If true, the ThreadContext stack and map are disabled. (May be ignored if a custom ThreadContext map is specified.)</td></tr>
<tr><td style="text-align: left">log4j2.disableThreadContextStack (disableThreadContextStack)</td><td style="text-align: left">LOG4J_DISABLE_THREAD_<br />CONTEXT_STACK</td><td style="text-align: left">false</td><td style="text-align: left">If true, the ThreadContext stack is disabled.</td></tr>
<tr><td style="text-align: left">log4j2.disableThreadContextMap (disableThreadContextMap)</td><td style="text-align: left">LOG4J_DISABLE_THREAD_<br />CONTEXT_MAP</td><td style="text-align: left">false</td><td style="text-align: left">If true, the ThreadContext map is disabled. (May be ignored if a custom ThreadContext map is specified.)</td></tr>
<tr><td style="text-align: left">log4j2.threadContextMap (log4j2.threadContextMap)</td><td style="text-align: left">LOG4J_THREAD_CONTEXT_MAP</td><td style="text-align: left"></td><td style="text-align: left">Fully specified class name of a custom ThreadContextMap implementation class.</td></tr>
<tr><td style="text-align: left">log4j2.isThreadContextMapInheritable (isThreadContextMapInheritable)</td><td style="text-align: left">LOG4J_IS_THREAD_CONTEXT<br />_MAP_INHERITABLE</td><td style="text-align: left">false</td><td style="text-align: left">If true use a InheritableThreadLocal to implement the ThreadContext map. Otherwise, use a plain ThreadLocal. (May be ignored if a custom ThreadContext map is specified.)</td></tr>
<tr><td style="text-align: left">log4j2.contextDataInjector (log4j2.ContextDataInjector)</td><td style="text-align: left">LOG4J_CONTEXT_DATA_INJECTOR</td><td style="text-align: left"></td><td style="text-align: left">Fully specified class name of a custom ContextDataInjector implementation class.</td></tr>
<tr><td style="text-align: left">log4j2.garbagefreeThreadContextMap (log4j2.garbagefree.threadContextMap)</td><td style="text-align: left">LOG4J_GARBAGEFREE_<br />THREAD_CONTEXT_MAP</td><td style="text-align: left">false</td><td style="text-align: left">Specify "true" to make the ThreadContext map garbage-free.</td></tr>
<tr><td style="text-align: left">log4j2.disableJmx (log4j2.disable.jmx)</td><td style="text-align: left">LOG4J_DISABLE_JMX</td><td style="text-align: left">false</td><td style="text-align: left">If true, Log4j configuration objects like LoggerContexts, Appenders, Loggers, etc. will not be instrumented with MBeans and cannot be remotely monitored and managed.</td></tr>
<tr><td style="text-align: left">log4j2.jmxNotifyAsync (log4j2.jmx.notify.async)</td><td style="text-align: left">LOG4J_JMX_NOTIFY_ASYNC</td><td style="text-align: left">false for web apps, true otherwise</td><td style="text-align: left">If true, log4j's JMX notifications are sent from a separate background thread, otherwise they are sent from the caller thread. If system property log4j2.is.webapp is true or the javax.servlet.Servlet class is on the classpath, the default behaviour is to use the caller thread to send JMX notifications.</td></tr>
<tr><td style="text-align: left">log4j2.skipJansi (log4j.skipJansi)</td><td style="text-align: left">LOG4J_SKIP_JANSI</td><td style="text-align: left">true</td><td style="text-align: left">If true, the ConsoleAppender will not try to use the Jansi output stream on Windows.</td></tr>
<tr><td style="text-align: left">log4j2.ignoreTCL (log4j.ignoreTCL)</td><td style="text-align: left">LOG4J_IGNORE_TCL</td><td style="text-align: left">false</td><td style="text-align: left">If true, classes are only loaded with the default class loader. Otherwise, an attempt is made to load classes with the current thread's context class loader before falling back to the default class loader.</td></tr>
<tr><td style="text-align: left">log4j2.uuidSequence (org.apache.logging.log4j.uuidSequence)</td><td style="text-align: left">LOG4J_UUID_SEQUENCE</td><td style="text-align: left">0</td><td style="text-align: left">System property that may be used to seed the UUID generation with an integer value.</td></tr>
<tr><td style="text-align: left">log4j2.simplelogShowContextMap (org.apache.logging.log4j .simplelog.showContextMap)</td><td style="text-align: left">LOG4J_SIMPLELOG_SHOW<br />_CONTEXT_MAP</td><td style="text-align: left">false</td><td style="text-align: left">If true, the full ThreadContext map is included in each SimpleLogger log message.</td></tr>
<tr><td style="text-align: left">log4j2.simplelogShowlogname (org.apache.logging.log4j .simplelog.showlogname)</td><td style="text-align: left">LOG4J_SIMPLELOG_SHOWLOGNAME</td><td style="text-align: left">false</td><td style="text-align: left">If true, the logger name is included in each SimpleLogger log message.</td></tr>
<tr><td style="text-align: left">log4j2.simplelogShowShortLogname (org.apache.logging.log4j .simplelog.showShortLogname)</td><td style="text-align: left">LOG4J_SIMPLELOG_SHOW_<br />SHORT_LOGNAME</td><td style="text-align: left">true</td><td style="text-align: left">If true, only the last component of a logger name is included in SimpleLogger log messages. (E.g., if the logger name is "mycompany.myproject.mycomponent", only "mycomponent" is logged.</td></tr>
<tr><td style="text-align: left">log4j2.simplelogShowdatetime (org.apache.logging.log4j .simplelog.showdatetime)</td><td style="text-align: left">LOG4J_SIMPLELOG_SHOWDATETIME</td><td style="text-align: left">false</td><td style="text-align: left">If true, SimpleLogger log messages contain timestamp information.</td></tr>
<tr><td style="text-align: left">log4j2.simplelogDateTimeFormat (org.apache.logging.log4j .simplelog.dateTimeFormat)</td><td style="text-align: left">LOG4J_SIMPLELOG_<br />DATE_TIME_FORMAT</td><td style="text-align: left">"yyyy/MM/dd HH:mm:ss:SSS zzz"</td><td style="text-align: left">Date-time format to use. Ignored if org.apache.logging.log4j .simplelog.showdatetime is false.</td></tr>
<tr><td style="text-align: left">log4j2.simplelogLogFile (org.apache.logging.log4j .simplelog.logFile)</td><td style="text-align: left">LOG4J_SIMPLELOG_LOG_FILE</td><td style="text-align: left">system.err</td><td style="text-align: left">"system.err" (case-insensitive) logs to System.err, "system.out" (case-insensitive) logs to System.out, any other value is interpreted as a file name to save SimpleLogger messages to.</td></tr>
<tr><td style="text-align: left">log4j2.simplelogLevel (org.apache.logging.log4j .simplelog.level)</td><td style="text-align: left">LOG4J_SIMPLELOG_LEVEL</td><td style="text-align: left">ERROR</td><td style="text-align: left">Default level for new SimpleLogger instances.</td></tr>
<tr><td style="text-align: left">log4j2.simplelog.<loggerName>.level (org.apache.logging.log4j .simplelog.<loggerName>.level)</td><td style="text-align: left">LOG4J_SIMPLELOG_&lt;LOGGER_NAME&gt;_LEVEL</td><td style="text-align: left">SimpleLogger default log level</td><td style="text-align: left">Log level for a the SimpleLogger instance with the specified name.</td></tr>
<tr><td style="text-align: left">log4j2.simplelogStatusLoggerLevel (org.apache.logging.log4j.simplelog .StatusLogger.level)</td><td style="text-align: left">LOG4J_SIMPLELOG_STATUS<br />_LOGGER_LEVEL</td><td style="text-align: left">ERROR</td><td style="text-align: left">This property is used to control the initial StatusLogger level, and can be overridden in code by calling StatusLogger.getLogger() .setLevel(someLevel). Note that the StatusLogger level is only used to determine the status log output level until a listener is registered. In practice, a listener is registered when a configuration is found, and from that point onwards, status messages are only sent to the listeners (depending on their statusLevel).</td></tr>
<tr><td style="text-align: left">log4j2.defaultStatusLevel (Log4jDefaultStatusLevel)</td><td style="text-align: left">LOG4J_DEFAULT_STATUS_LEVEL</td><td style="text-align: left">ERROR</td><td style="text-align: left">The StatusLogger logs events that occur in the logging system to the console. During configuration, AbstractConfiguration registers a StatusConsoleListener with the StatusLogger that may redirect status log events from the default console output to a file. The listener also supports fine-grained filtering. This system property specifies the default status log level for the listener to use if the configuration does not specify a status level.Note: this property is used by the log4j-core implementation only after a configuration file has been found.</td></tr>
<tr><td style="text-align: left">log4j2.statusLoggerLevel (log4j2.StatusLogger.level)</td><td style="text-align: left">LOG4J_STATUS_LOGGER_LEVEL</td><td style="text-align: left">WARN</td><td style="text-align: left">The initial "listenersLevel" of the StatusLogger. If StatusLogger listeners are added, the "listenerLevel" is changed to that of the most verbose listener. If any listeners are registered, the listenerLevel is used to quickly determine if an interested listener exists.By default, StatusLogger listeners are added when a configuration is found and by the JMX StatusLoggerAdmin MBean. For example, if a configuration contains <Configuration status="trace">, a listener with statusLevel TRACE is registered and the StatusLogger listenerLevel is set to TRACE, resulting in verbose status messages displayed on the console.If no listeners are registered, the listenersLevel is not used, and the StatusLogger output level is determined by StatusLogger.getLogger().getLevel() (see property org.apache.logging.log4j.simplelog .StatusLogger.level).</td></tr>
<tr><td style="text-align: left">log4j2.statusEntries (log4j2.status.entries)</td><td style="text-align: left">LOG4J_STATUS_ENTRIES</td><td style="text-align: left">200</td><td style="text-align: left">Number of StatusLogger events that are kept in a buffer and can be retrieved with StatusLogger.getStatusData().</td></tr>
<tr><td style="text-align: left">log4j2.statusLoggerDateformat (log4j2.StatusLogger.DateFormat)</td><td style="text-align: left">LOG4J_STATUS_LOGGER<br />_DATEFORMAT</td><td style="text-align: left"></td><td style="text-align: left">Date-time format string to use as the format for timestamps in the status logger output. See java.text.SimpleDateFormat for supported formats.</td></tr>
<tr><td style="text-align: left">log4j2.asyncLoggerExceptionHandler (AsyncLogger.ExceptionHandler)</td><td style="text-align: left">LOG4J_ASYNC_LOGGER<br />_EXCEPTION_HANDLER</td><td style="text-align: left">default handler</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsAllAsync">Async Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">log4j2.asyncLoggerRingBufferSize (AsyncLogger.RingBufferSize)</td><td style="text-align: left">LOG4J_ASYNC_LOGGER<br />_RING_BUFFER_SIZE</td><td style="text-align: left">256 * 1024 or 4 * 1024 in garbage-free mode</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsAllAsync">Async Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">log4j2.asyncLoggerWaitStrategy (AsyncLogger.WaitStrategy)</td><td style="text-align: left">LOG4J_ASYNC_LOGGER<br />_WAIT_STRATEGY</td><td style="text-align: left">Timeout</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsAllAsync">Async Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">log4j2.asyncLoggerTimeout (AsyncLogger.Timeout)</td><td style="text-align: left">LOG4J_ASYNC_LOGGER_TIMEOUT</td><td style="text-align: left">10</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsAllAsync">Async Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">log4j2.asyncLoggerSleepTimeNs (AsyncLogger.SleepTimeNs)</td><td style="text-align: left">LOG4J_ASYNC_LOGGER_SLEEP_TIME_NS</td><td style="text-align: left">100</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsAllAsync">Async Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">log4j2.asyncLoggerRetries (AsyncLogger.Retries)</td><td style="text-align: left">LOG4J_ASYNC_LOGGER_SLEEP_TIME_NS</td><td style="text-align: left">200</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsAllAsync">Async Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">AsyncLogger.SynchronizeEnqueueWhenQueueFull</td><td style="text-align: left">ASYNC_LOGGER_SYNCHRONIZE_<br />ENQUEUE_WHEN_QUEUE_FULL</td><td style="text-align: left">true</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsAllAsync">Async Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">log4j2.asyncLoggerThreadNameStrategy (AsyncLogger.ThreadNameStrategy)</td><td style="text-align: left">LOG4J_ASYNC_LOGGER_THREAD_<br />NAME_STRATEGY</td><td style="text-align: left">CACHED</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsAllAsync">Async Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">log4j2.asyncLoggerConfigExceptionHandler (AsyncLoggerConfig.ExceptionHandler)</td><td style="text-align: left">LOG4J_ASYNC_LOGGER_CONFIG_<br />EXCEPTION_HANDLER</td><td style="text-align: left">default handler</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsMixedSync-Async">Mixed Async/Synchronous Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">log4j2.asyncLoggerConfigRingBufferSize (AsyncLoggerConfig.RingBufferSize)</td><td style="text-align: left">LOG4J_ASYNC_LOGGER_CONFIG_<br />RING_BUFFER_SIZE</td><td style="text-align: left">256 * 1024 or 4 * 1024 in garbage-free mode</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsMixedSync-Async">Mixed Async/Synchronous Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">log4j2.asyncLoggerConfigWaitStrategy (AsyncLoggerConfig.WaitStrategy)</td><td style="text-align: left">LOG4J_ASYNC_LOGGER_CONFIG_<br />WAIT_STRATEGY</td><td style="text-align: left">Timeout</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsMixedSync-Async">Mixed Async/Synchronous Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">AsyncLoggerConfig.SynchronizeEnqueueWhenQueueFull</td><td style="text-align: left">ASYNC_LOGGER_CONFIG_SYNCHRONIZE<br />_ENQUEUE_WHEN_QUEUE_FULL</td><td style="text-align: left">true</td><td style="text-align: left">See <a href="https://logging.apache.org/log4j/2.x/manual/async.html#SysPropsMixedSync-Async">Mixed Async/Synchronous Logger System Properties</a> for details.</td></tr>
<tr><td style="text-align: left">log4j2.julLoggerAdapter (log4j.jul.LoggerAdapter)</td><td style="text-align: left">LOG4J_JUL_LOGGER_ADAPTER</td><td style="text-align: left">org.apache.logging.log4j .jul.ApiLoggerAdapter</td><td style="text-align: left">Default LoggerAdapter to use in the JUL adapter. By default, if log4j-core is available, then the class org.apache.logging.log4j.jul .CoreLoggerAdapter will be used. Otherwise, the ApiLogggerAdapter will be used. Custom implementations must provide a public default constructor.</td></tr>
<tr><td style="text-align: left">log4j2.formatMsgAsync (log4j.format.msg.async)</td><td style="text-align: left">LOG4J_FORMAT_MSG_ASYNC</td><td style="text-align: left">false</td><td style="text-align: left">If false (the default), Log4j will make sure the message is formatted in the caller thread, to ensure the value at the time of the call to the logger is the value that is logged.</td></tr>
<tr><td style="text-align: left">log4j2.asyncQueueFullPolicy (log4j2.AsyncQueueFullPolicy)</td><td style="text-align: left">LOG4J_ASYNC_QUEUE_FULL_POLICY</td><td style="text-align: left"></td><td style="text-align: left">Used by Async Loggers and the AsyncAppender to maintain application throughput even when the underlying appender cannot keep up with the logging rate and the queue is filling up.If no value is specified (the default) events are never discarded. If the queue is full, the logger call blocks until the event can be added to the queue.Specify Discard to drop events whose level is equal or less than the threshold level (INFO by default) when the queue is full.</td></tr>
<tr><td style="text-align: left">log4j2.discardThreshold (log4j2.DiscardThreshold)</td><td style="text-align: left">LOG4J_DISCARD_THRESHOLD</td><td style="text-align: left">INFO</td><td style="text-align: left">Used by the DiscardingAsyncQueueFullPolicy to determine which events to drop when the queue becomes full. By default, INFO, DEBUG and TRACE level events are discarded when the queue is full. This property only has effect if Discard is specified as the log4j2.AsyncQueueFullPolicy.</td></tr>
<tr><td style="text-align: left">log4j2.messageFactory (log4j2.messageFactory)</td><td style="text-align: left">LOG4J_MESSAGE_FACTORY</td><td style="text-align: left">org.apache.logging.log4j.message. ParameterizedMessageFactory or org.apache.logging.log4j.message. ReusableMessageFactory in garbage-free mode</td><td style="text-align: left">Default message factory used by Loggers if no factory was specified.</td></tr>
<tr><td style="text-align: left">log4j2.flowMessageFactory (log4j2.flowMessageFactory)</td><td style="text-align: left">LOG4J_FLOW_MESSAGE_FACTORY</td><td style="text-align: left">org.apache.logging.log4j.message. DefaultFlowMessageFactory</td><td style="text-align: left">Default flow message factory used by Loggers.</td></tr>
<tr><td style="text-align: left">log4j2.isWebapp (log4j2.is.webapp)</td><td style="text-align: left">LOG4J_IS_WEBAPP</td><td style="text-align: left">true if Servlet class on class path</td><td style="text-align: left">This system property can be used to force Log4j 2 to behave as if it is part of a web application (when true) or as if it is not part of a web application (when false).</td></tr>
<tr><td style="text-align: left">log4j2.enableThreadlocals (log4j2.enable.threadlocals)</td><td style="text-align: left">LOG4J_ENABLE_THREADLOCALS</td><td style="text-align: left">true</td><td style="text-align: left">This system property can be used to switch off the use of threadlocals, which will partly disable Log4j's garbage-free behaviour: to be fully garbage-free, Log4j stores objects in ThreadLocal fields to reuse them, otherwise new objects are created for each log event. Note that this property is not effective when Log4j detects it is running in a web application.</td></tr>
<tr><td style="text-align: left">log4j2.enableDirectEncoders (log4j2.enable.direct.encoders)</td><td style="text-align: left">LOG4J_ENABLE_DIRECT_ENCODERS</td><td style="text-align: left">true</td><td style="text-align: left">This property can be used to force garbage-aware Layouts and Appenders to revert to the pre-2.6 behaviour where converting log events to text generates temporary objects like Strings and char[] arrays, and converting this text to bytes generates temporary byte[] arrays. By default, this property is true and garbage-aware Layouts and Appenders that convert log events to text will convert this text to bytes without creating temporary objects.</td></tr>
<tr><td style="text-align: left">log4j2.initialReusableMsgSize (log4j.initialReusableMsgSize)</td><td style="text-align: left">LOG4J_INITIAL_REUSABLE_MSG_SIZE</td><td style="text-align: left">128</td><td style="text-align: left">In GC-free mode, this property determines the initial size of the reusable StringBuilders where the message text is formatted and potentially passed to background threads.</td></tr>
<tr><td style="text-align: left">log4j2.maxReusableMsgSize (log4j.maxReusableMsgSize)</td><td style="text-align: left">LOG4J_MAX_REUSABLE_MSG_SIZE</td><td style="text-align: left">518</td><td style="text-align: left">In GC-free mode, this property determines the maximum size of the reusable StringBuilders where the message text is formatted and potentially passed to background threads.</td></tr>
<tr><td style="text-align: left">log4j2.layoutStringBuilderMaxSize (log4j.layoutStringBuilder.maxSize)</td><td style="text-align: left">LOG4J_LAYOUT_STRING<br />_BUILDER_MAX_SIZE</td><td style="text-align: left">2048</td><td style="text-align: left">This property determines the maximum size of the thread-local reusable StringBuilders used to format the log event to text by Layouts that extend AbstractStringLayout.</td></tr>
<tr><td style="text-align: left">log4j2.unboxRingbufferSize (log4j.unbox.ringbuffer.size)</td><td style="text-align: left">LOG4J_UNBOX_RINGBUFFER_SIZE</td><td style="text-align: left">32</td><td style="text-align: left">The org.apache.logging.log4j.util.Unbox utility manages a small thread-local ring buffer of StringBuilders. Each time one of the box() methods is called, the next slot in the ring buffer is used, until the ring buffer is full and the first slot is reused. By default the Unbox ring buffer has 32 slots, so user code can have up to 32 boxed primitives in a single logger call.If more slots are required, set system property log4j.unbox.ringbuffer.size to the desired ring buffer size. Note that the specified number will be rounded up to the nearest power of 2.</td></tr>
<tr><td style="text-align: left">log4j2.loggerContextStacktraceOnStart (log4j.LoggerContext.stacktrace.on.start)</td><td style="text-align: left">LOG4J_LOGGER_CONTEXT<br />_STACKTRACE_ON_START</td><td style="text-align: left">false</td><td style="text-align: left">Prints a stacktrace to the <a href="https://logging.apache.org/log4j/2.x/manual/configuration.html#StatusMessages">status logger</a> at DEBUG level when the LoggerContext is started. For debug purposes.</td></tr>
<tr><td style="text-align: left">log4j2.formatMsgNoLookups (log4j2.formatMsgNoLookups)</td><td style="text-align: left">FORMAT_MESSAGES_<br />PATTERN_DISABLE_LOOKUPS</td><td style="text-align: left">false</td><td style="text-align: left">Disables message pattern lookups globally when set to true. This is equivalent to defining all message patterns using %m{nolookups}.</td></tr>
<tr><td style="text-align: left">log4j2.trustStoreLocation</td><td style="text-align: left">LOG4J_TRUST_STORE_LOCATION</td><td style="text-align: left"></td><td style="text-align: left">The location of the trust store. If not provided the default trust store will be used.</td></tr>
<tr><td style="text-align: left">log4j2.trustStorePassword</td><td style="text-align: left">LOG4J_TRUST_STORE_PASSWORD</td><td style="text-align: left"></td><td style="text-align: left">Password needed to access the trust store.</td></tr>
<tr><td style="text-align: left">log4j2.trustStorePasswordFile</td><td style="text-align: left">LOG4J_TRUST_STORE_PASSWORD_FILE</td><td style="text-align: left"></td><td style="text-align: left">The location of a file that contains the password for the trust store.</td></tr>
<tr><td style="text-align: left">log4j2.trustStorePasswordEnvironmentVariable</td><td style="text-align: left">LOG4J_TRUST_STORE_PASSWORD_<br />ENVIRONMENT_VARIABLE</td><td style="text-align: left"></td><td style="text-align: left">The name of the environment variable that contains the trust store password.</td></tr>
<tr><td style="text-align: left">log4j2.trustStoreType</td><td style="text-align: left">LOG4J_TRUST_STORE_TYPE</td><td style="text-align: left"></td><td style="text-align: left">The type of key store used for the trust store.</td></tr>
<tr><td style="text-align: left">log4j2.trustStoreKeyManagerFactoryAlgorithm</td><td style="text-align: left">LOG4J_TRUST_STORE_KEY_<br />MANAGER_FACTORY_ALGORITHM</td><td style="text-align: left"></td><td style="text-align: left">Java cryptographic algorithm.</td></tr>
<tr><td style="text-align: left">log4j2.keyStoreLocation</td><td style="text-align: left">LOG4J_KEY_STORE_LOCATION</td><td style="text-align: left"></td><td style="text-align: left">The location of the key store. If not provided the default key store will be used.</td></tr>
<tr><td style="text-align: left">log4j2.keyStorePassword</td><td style="text-align: left">LOG4J_KEY_STORE_PASSWORD</td><td style="text-align: left"></td><td style="text-align: left">Password needed to access the key store.</td></tr>
<tr><td style="text-align: left">log4j2.keyStorePasswordFile</td><td style="text-align: left">LOG4J_KEY_STORE_PASSWORD_FILE</td><td style="text-align: left"></td><td style="text-align: left">The location of a file that contains the password for the key store.</td></tr>
<tr><td style="text-align: left">log4j2.keyStorePasswordEnvironmentVariable</td><td style="text-align: left">LOG4J_KEY_STORE_PASSWORD_<br />ENVIRONMENT_VARIABLE</td><td style="text-align: left"></td><td style="text-align: left">The name of the environment variable that contains the key store password.</td></tr>
<tr><td style="text-align: left">log4j2.keyStoreType</td><td style="text-align: left">LOG4J_KEY_STORE_TYPE</td><td style="text-align: left"></td><td style="text-align: left">The type of key store.</td></tr>
<tr><td style="text-align: left">log4j2.keyStoreKeyManagerFactoryAlgorithm</td><td style="text-align: left">LOG4J_KEY_STORE_KEY_MANAGER_<br />FACTORY_ALGORITHM</td><td style="text-align: left"></td><td style="text-align: left">Java cryptographic algorithm.</td></tr>
<tr><td style="text-align: left">log4j2.sslVerifyHostName</td><td style="text-align: left"></td><td style="text-align: left">false</td><td style="text-align: left">true or false if the host name should be verified</td></tr>
</tbody></table>
</div><script src="/note-service/java/infisearch_assets/search-ui.chinese.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/note-service/java/infisearch_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/note-service/java/';
const mode = 'target';
infisearch.init({
  searcherOptions: {
    url: base_url + 'infisearch_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('infisearch-mdbook-target'),
    fsButtonPlaceholder: 'Search',
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      searchedTermsParam: 'search',
    },
    multiSelectFilters: [
      { fieldName: 'partTitle', displayName: 'Section', defaultOptName: 'None' },
    ],
  },
});

document.getElementById('infi-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script>
<p><span data-infisearch-part-title="未分类"></span></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../19.日志/log4j2/log4j2配置/README.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../19.日志/log4j2/layouts/README.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../19.日志/log4j2/log4j2配置/README.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../19.日志/log4j2/layouts/README.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
