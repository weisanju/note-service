<!DOCTYPE HTML>
<html lang="zh_CN" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>UsingInvokeAslibrary - Python</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="/note-service/favicon.svg">
        <link rel="shortcut icon" href="/note-service/favicon.png">
        <link rel="stylesheet" href="/note-service/css/variables.css">
        <link rel="stylesheet" href="/note-service/css/general.css">
        <link rel="stylesheet" href="/note-service/css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="https://xjq-note.oss-cn-hangzhou.aliyuncs.com/FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="https://xjq-note.oss-cn-hangzhou.aliyuncs.com/fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="https://xjq-note.oss-cn-hangzhou.aliyuncs.com/highlight.css">
        <link rel="stylesheet" href="https://xjq-note.oss-cn-hangzhou.aliyuncs.com/tomorrow-night.css">
        <link rel="stylesheet" href="https://xjq-note.oss-cn-hangzhou.aliyuncs.com/ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../index.html">Python笔记库</a></li><li class="chapter-item affix "><li class="part-title">python基础</li><li class="chapter-item "><a href="../../python基础_1_python基础/index.html">python基础</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../python基础_1_python基础/1.python3基础语法.html">python3基础语法</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/2.基本数据类型.html">基本数据类型</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/3.Python3数据类型转换.html">Python3数据类型转换</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/4.Python推导式.html">Python推导式</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/5.Python3运算符.html">Python3运算符</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/6.Python3字符串.html">Python3字符串</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/7.python3列表.html">python3列表</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/8.元祖.html">元祖</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/9.Python3字典.html">Python3字典</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/10.Python3集合.html">Python3集合</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/11.Number类型.html">Number类型</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/12.python3流程控制.html">python3流程控制</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/13.Python3迭代器与生成器.html">Python3迭代器与生成器</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/14.函数.html">函数</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/15.Python3JSON数据解析.html">Python3JSON数据解析</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/16.Python3面向对象.html">Python3面向对象</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/17.模块与包.html">模块与包</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/With关键字.html">With关键字</a></li><li class="chapter-item "><a href="../../python基础_1_python基础/杂项.html">杂项</a></li></ol></li><li class="chapter-item "><li class="part-title">python三方库</li><li class="chapter-item expanded "><div>fabric</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../python三方库_2_fabric/fabric/index.html">fabric</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../python三方库_2_fabric/fabric/Configuration.html">Configuration</a></li><li class="chapter-item "><a href="../../python三方库_2_fabric/fabric/README_1.x.html">README_1.x</a></li></ol></li><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/invoke/index.html">invoke</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../python三方库_2_fabric/invoke/1.DefiningAndRunningTask.html">DefiningAndRunningTask</a></li><li class="chapter-item "><a href="../../python三方库_2_fabric/invoke/2.InvokeCoreUsage.html">InvokeCoreUsage</a></li><li class="chapter-item "><a href="../../python三方库_2_fabric/invoke/3.Configuration.html">Configuration</a></li><li class="chapter-item "><a href="../../python三方库_2_fabric/invoke/4.loadingCollections.html">loadingCollections</a></li><li class="chapter-item expanded "><a href="../../python三方库_2_fabric/invoke/5.UsingInvokeAslibrary.html" class="active">UsingInvokeAslibrary</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Python</h1>

                    <div class="right-buttons">

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="/note-service/python/infisearch_assets/search-ui-light.css">
<style>.light .infi-root,
.rust .infi-root,
.coal .infi-root,
.navy .infi-root,
.ayu .infi-root {
    --infi-shadow: none;
    --infi-border: 3px solid var(--table-header-bg);
    --infi-bg: var(--bg);
    --infi-triangle-bg: var(--table-header-bg);
    --infi-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --infi-title-fg: var(--fg);
    --infi-title-hover-fg: var(--fg);
    --infi-title-hover-bg: var(--table-header-bg);
    --infi-title-border-bottom-hover: 2px solid var(--table-header-bg);
    --infi-heading-fg: var(--fg);
    --infi-heading-hover-fg: var(--fg);
    --infi-body-fg: var(--fg);
    --infi-body-hover-fg: var(--fg);
    --infi-sub-bg: var(--bg);
    --infi-highlight: var(--search-mark-bg);
    --infi-highlight-bg: none;
    --infi-header-fg: var(--fg);
    --infi-checkbox-bg: #f8f8f8;
    --infi-checkbox-checked-bg: #fff;
    --infi-checkbox-border: #414141;
    --infi-filter-header-active: var(--infi-title-bg);
    --infi-error-fg: var(--fg);
    --infi-fine-print-fg: var(--fg);
    --infi-loading-bg: var(--fg);
    --infi-loading-secondary-bg: var(--fg);
    --infi-load-more-fg: var(--infi-title-fg);
    --infi-load-more-bg: var(--infi-title-bg);
    --infi-load-more-hover-fg: var(--infi-title-hover-fg);
    --infi-load-more-hover-bg: var(--infi-title-hover-bg);
    --infi-scrollbar-bg: none;
    --infi-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --infi-fs-button-input-fg: var(--searchbar-shadow-color);
    --infi-fs-border: 3px solid var(--sidebar-bg);
    --infi-fs-box-shadow: none;
    --infi-fs-header-bg: var(--sidebar-bg);
    --infi-fs-header-box-shadow: none;
    --infi-tip-table-header-border: var(--table-border-color);
    --infi-tip-table-border: transparent;
    --infi-tip-table-alternate: var(--table-alternate-bg);
    --infi-tip-bg: var(--sidebar-bg);
    --infi-tip-fg: var(--sidebar-fg);
    --infi-tip-code-fg: var(--inline-code-color);
    --infi-tip-code-bg: transparent;
    --infi-tip-icon-bg: rgb(230, 230, 230);
    --infi-tip-icon-fg: rgb(80, 80, 80);
}

.light .infi-root {
    --infi-fs-header-close-fg: var(--searchresults-header-fg);
    --infi-fs-header-close-hover-fg: var(--fg);
}

.ayu .infi-root,
.rust .infi-root,
.coal .infi-root,
.navy .infi-root {
    --infi-fs-header-close-fg: var(--sidebar-fg);
    --infi-fs-header-close-hover-fg: white;
}

.ayu .infi-root,
.rust .infi-root {
    --infi-tip-code-fg: var(--search-mark-bg) !important;
    --infi-tip-icon-bg: rgb(200, 200, 200);
    --infi-tip-icon-fg: rgb(50, 50, 50);
}

.light .infi-root .infi-list-item.focus,
.rust .infi-root .infi-list-item.focus,
.coal .infi-root .infi-list-item.focus,
.navy .infi-root .infi-list-item.focus,
.ayu .infi-root .infi-list-item.focus {
    outline: 2px solid grey;
}

.light .infi-root,
.coal .infi-root,
.navy .infi-root,
.ayu .infi-root {
    --infi-title-bg: var(--theme-hover);
    --infi-sub-hover-bg: var(--table-alternate-bg);
    --infi-title-border-bottom: 2px solid var(--theme-hover);
}

.light .infi-root {
    --infi-highlight: #82a6c4;
    --infi-sub-hover-bg: #ebebeb;
}

.rust .infi-root {
    --infi-highlight: #bc8e6a;

    --infi-tip-table-alternate: var(--sidebar-bg);
    --infi-title-bg: var(--table-header-bg);
    --infi-title-border-bottom: 2px solid var(--table-header-bg);

    --infi-sub-hover-bg: #c6bbb1;
    --infi-title-bg: #bbada1;
    --infi-title-border-bottom: 2px solid #bbada1;
    --infi-title-hover-fg: #000;
    --infi-title-hover-bg: #a19488;
    --infi-title-border-bottom-hover: 2px solid #a19488;
    --infi-body-hover-fg: #1e1e1e;
    --infi-heading-hover-fg: #1e1e1e;
}

.coal .infi-root {
    --infi-highlight: #496c8a;
    --infi-sub-hover-bg: #272a2b;
}

.infi-theme .infi-root .infi-tip-item code,
.rust .infi-root .infi-tip-item code {
    color: var(--infi-tip-code-fg) !important;;
}

.coal .infi-root,
.navy .infi-root,
.ayu .infi-root {
    --infi-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
    --infi-fs-input-fg: var(--fg);
    --infi-fs-input-focus-border: 2px solid #4f95cc;
    --infi-fs-input-focus-box-shadow: 0 0 5px -1px #63baff;
    --infi-key-fg: #fff;
    --infi-key-bg: #7d7d7d;
    --infi-checkbox-bg: #313233;
    --infi-checkbox-checked-bg: #424243;
    --infi-checkbox-border: #525354;
}

.rust .infi-root {
    --infi-fs-input-fg: var(--sidebar-fg);
    --infi-fs-input-bg: #29201d;
    --infi-fs-input-border: 2px solid #584d4a;
    --infi-fs-input-focus-border: 2px solid #4f95cc;
    --infi-fs-input-focus-box-shadow: 0 0 5px -1px #63baff;
}

.coal .infi-root {
    --infi-fs-input-bg: #1d1f21;
    --infi-fs-input-border: 2px solid #3e4144;
}

.navy .infi-root {
    --infi-fs-input-bg: #1e222f;
    --infi-fs-input-border: 2px solid #3d4252;
    --infi-sub-hover-bg: #242734;
}

.ayu .infi-root {
    --infi-fs-input-fg: var(--fg);
    --infi-fs-input-bg: #2b3035;
    --infi-fs-input-border: 2px solid #43474c;
    --infi-fs-input-focus-border: 2px solid #4f95cc;
    --infi-fs-input-focus-box-shadow: 0 0 5px -1px #63baff;
    --infi-sub-hover-bg: #282e35;
}

#infi-search {
    width: 100%;
    border-radius: 3px;
    box-sizing: border-box;
    padding: 10px 16px;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
}

#infi-search:focus:not(.infi-button-input) {
    box-shadow: 0 0 3px var(--searchbar-shadow-color);
}

#infi-search.infi-button-input {
    width: 100px;
}

#infi-search.infi-button-input::placeholder {
    position: relative;
    left: 14px;
}

#infi-search.infi-button-input:hover {
    transition: 0.3s ease-out;
    background: var(--infi-fs-button-input-bg) !important;
    outline: 2px solid var(--infi-fs-button-input-bg);
}

#infi-search.infi-button-input:hover::placeholder {
    color: var(--infi-fs-button-input-fg) !important;
}

@media print {
    #infi-search {
        display: none;
    }
}

#infisearch-mdbook-target {
    position: relative;
}

/*
 * For this plugin, don't show the controls until there is a query.
 */
#infisearch-mdbook-target.infi-empty-input > * {
    display: none;
}

.infi-root:not(.infi-fs-root) {
    display: block;
}

.light .infi-root .infi-title::after,
.rust .infi-root .infi-title::after,
.coal .infi-root .infi-title::after,
.navy .infi-root .infi-title::after,
.ayu .infi-root .infi-title::after {
    content: none;
    display: none;
}

.infi-header {
    padding-bottom: 9px;
}

.infi-load-more {
    padding: 7px 15px;
}
</style>
<p><input
    type="search"
    id="infi-search"
    placeholder="Search this book ..."
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div id="infisearch-mdbook-target"></div>
<h1 id="using-invoke-as-a-library"><a class="header" href="#using-invoke-as-a-library">Using Invoke as a library</a></h1>
<p>虽然我们的大多数文档都涉及用户/CLI面对任务管理和命令执行的用例，但Invoke的设计目的是让高级用户可以独立使用其组成部分-开箱即用或最少的额外工作。CLI解析，子流程命令执行，任务组织等都被写成广泛分离的关注点。
本文档概述了已知可行的用例 (因为像Fabric这样的下游工具已经在利用它们)。</p>
<h2 id="reusing-invokes-cli-module-as-a-distinct-binary"><a class="header" href="#reusing-invokes-cli-module-as-a-distinct-binary">Reusing Invoke’s CLI module as a distinct binary</a></h2>
<p>一个主要的用例是在引擎盖下使用Invoke分发自己的程序，绑定到不同的二进制名称，并且通常将特定的任务命名空间设置为默认值。(这与标准库中的argparse类似的东西有点接近。)在某些情况下，还需要移除、替换和/或添加核心CLI标志。</p>
<h3 id="getting-set-up"><a class="header" href="#getting-set-up">Getting set up</a></h3>
<p>假设您要分发一个名为tester的测试运行器，提供两个子命令，即单元和集成，以便用户可以pip安装tester并可以访问tester unit，tester integration或tester integration-fail-fast之类的命令。
首先，与提供CLI “二进制” 的任何不同的Python包一样，您将通知您的setup.py您的入口点:</p>
<pre><code>setup(
    name='tester',
    version='0.1.0',
    packages=['tester'],
    install_requires=['invoke'],
    entry_points={
        'console_scripts': ['tester = tester.main:program.run']
    }
)
</code></pre>
<p>This is just an example snippet and is not a fully valid <code>setup.py</code>; if you don’t know how Python packaging works, a good starting place is <a href="https://python-packaging-user-guide.readthedocs.io/">the Python Packaging User’s Guide</a>.</p>
<p>这里没有什么是特定的Invoke-这是告诉Python安装一个测试器脚本的标准方法，该脚本执行在模块tester.main中定义的程序对象的run方法。</p>
<h3 id="creating-a-program"><a class="header" href="#creating-a-program">Creating a <code>Program</code></a></h3>
<p>In our <code>tester/main.py</code>, we start out importing Invoke’s public CLI functionality:</p>
<pre><code>from invoke import Program
</code></pre>
<p>然后我们定义我们在setup.py中引用的程序对象，这是一个简单的程序来完成繁重的工作，为初学者提供我们的版本号:</p>
<pre><code>program = Program(version='0.1.0')
</code></pre>
<p>At this point, installing <code>tester</code> would give you the same functionality as Invoke’s <a href="https://docs.pyinvoke.org/en/stable/invoke.html">built-in CLI tool</a>, except named <code>tester</code> and exposing its own version number:</p>
<pre><code class="language-shell">$ tester --version
Tester 0.1.0
$ tester --help
Usage: tester [--core-opts] task1 [--task1-opts] ... taskN [--taskN-opts]

Core options:
    ... core Invoke options here ...

$ tester --list
Can't find any collection named 'tasks'!
</code></pre>
<p>This doesn’t do us much good yet - there aren’t any subcommands (and our users don’t care about arbitrary ‘tasks’, so Invoke’s own default <code>--help</code> and <code>--list</code> output isn’t a good fit).</p>
<h3 id="specifying-subcommands"><a class="header" href="#specifying-subcommands">Specifying subcommands</a></h3>
<p>For <code>tester</code> to expose <code>unit</code> and <code>integration</code> subcommands, we need to define them, in a regular Invoke tasks module or <a href="https://docs.pyinvoke.org/en/stable/concepts/namespaces.html">namespace</a>. For our example, we’ll just create <code>tester/tasks.py</code> (but as you’ll see in a moment, this too is arbitrary and can be whatever you like):</p>
<pre><code>from invoke import task

@task
def unit(c):
    print(&quot;Running unit tests!&quot;)

@task
def integration(c):
    print(&quot;Running integration tests!&quot;)
</code></pre>
<p>As described in <a href="https://docs.pyinvoke.org/en/stable/concepts/namespaces.html">Constructing namespaces</a>, you can arrange this module however you want - the above snippet uses an implicit namespace for brevity’s sake.</p>
<p>Note</p>
<p>It’s important to realize that there’s nothing special about these “subcommands” - you could run them just as easily with vanilla Invoke, e.g. via <code>invoke --collection=tester.tasks --list</code>.</p>
<p>Now the useful part: telling our custom <a href="https://docs.pyinvoke.org/en/stable/api/program.html#invoke.program.Program"><code>Program</code></a> that this namespace of tasks should be used as the subcommands for <code>tester</code>, via the <code>namespace</code> kwarg:</p>
<pre><code class="language-python">from invoke import Collection, Program
from tester import tasks

program = Program(namespace=Collection.from_module(tasks), version='0.1.0')
</code></pre>
<p>The result?</p>
<pre><code>$ tester --version
Tester 0.1.0
$ tester --help
Usage: tester [--core-opts] &lt;subcommand&gt; [--subcommand-opts] ...

Core options:
  ... core options here, minus task-related ones ...

Subcommands:
  unit
  integration

$ tester --list
No idea what '--list' is!
$ tester unit
Running unit tests!
</code></pre>
<p>Notice how the ‘usage’ line changed (to specify ‘subcommands’ instead of ‘tasks’); the list of specific subcommands is now printed as part of <code>--help</code>; and <code>--list</code> has been removed from the options.</p>
<p>You can enable <a href="https://docs.pyinvoke.org/en/stable/invoke.html#tab-completion">tab-completion</a> for your distinct binary and subcommands.</p>
<h3 id="modifying-core-parser-arguments"><a class="header" href="#modifying-core-parser-arguments">Modifying core parser arguments</a></h3>
<p>A common need for this use case is tweaking the core parser arguments. <a href="https://docs.pyinvoke.org/en/stable/api/program.html#invoke.program.Program"><code>Program</code></a> makes it easy: default core <a href="https://docs.pyinvoke.org/en/stable/api/parser.html#invoke.parser.argument.Argument"><code>Arguments</code></a> are returned by <a href="https://docs.pyinvoke.org/en/stable/api/program.html#invoke.program.Program.core_args"><code>Program.core_args</code></a>. Extend this method’s return value with <code>super</code> and you’re done:</p>
<pre><code class="language-python"># Presumably, this is your setup.py-designated CLI module...

from invoke import Program, Argument

class MyProgram(Program):
    def core_args(self):
        core_args = super(MyProgram, self).core_args()
        extra_args = [
            Argument(names=('foo', 'f'), help=&quot;Foo the bars&quot;),
            # ...
        ]
        return core_args + extra_args

program = MyProgram()
</code></pre>
<p>Warning</p>
<p>我们不建议省略任何现有的核心参数; 许多基本功能依赖于它们的存在，即使保留默认值也是如此。</p>
<h2 id="customizing-the-configuration-systems-defaults"><a class="header" href="#customizing-the-configuration-systems-defaults">Customizing the configuration system’s defaults</a></h2>
<p>Besides the CLI-oriented content of the previous section, another area of functionality that frequently needs updating when redistributing an Invoke codebase (CLI or no CLI) is configuration. There are typically two concerns here:</p>
<ul>
<li>Configuration filenames and the env var prefix - crucial if you ever expect your users to use the configuration system;</li>
<li>Default configuration values - less critical (most defaults aren’t labeled with anything Invoke-specific) but still sometimes desirable.</li>
</ul>
<p>Note</p>
<p>Both of these involve subclassing <a href="https://docs.pyinvoke.org/en/stable/api/config.html#invoke.config.Config"><code>Config</code></a> (and, if using the CLI machinery, informing your <a href="https://docs.pyinvoke.org/en/stable/api/program.html#invoke.program.Program"><code>Program</code></a> to use that subclass instead of the default one.)</p>
<h3 id="changing-filenames-andor-env-var-prefix"><a class="header" href="#changing-filenames-andor-env-var-prefix">Changing filenames and/or env var prefix</a></h3>
<p>By default, Invoke’s config system looks for files like <code>/etc/invoke.yaml</code>, <code>~/.invoke.json</code>, etc. If you’re distributing client code named something else, like the <code>Tester</code> example earlier, you might instead want the config system to load <code>/etc/tester.json</code> or <code>$CWD/tester.py</code>.</p>
<p>Similarly, the environment variable config level looks for env vars like <code>INVOKE_RUN_ECHO</code>; you might prefer <code>TESTER_RUN_ECHO</code>.</p>
<p>There are a few <a href="https://docs.pyinvoke.org/en/stable/api/config.html#invoke.config.Config"><code>Config</code></a> attributes controlling these values:</p>
<ul>
<li><code>prefix</code>: A generic, catchall prefix used directly as the file prefix, and used via all-caps as the env var prefix;</li>
<li><code>file_prefix</code>: For overriding just the filename prefix - otherwise, it defaults to the value of <code>prefix</code>;</li>
<li><code>env_prefix</code>: For overriding just the env var prefix - as you might have guessed, it too defaults to the value of <code>prefix</code>.</li>
</ul>
<p>Continuing our ‘Tester’ example, you’d do something like this:</p>
<pre><code>from invoke import Config

class TesterConfig(Config):
    prefix = 'tester'
</code></pre>
<p>Or, to seek <code>tester.yaml</code> as before, but <code>TEST_RUN_ECHO</code> instead of <code>TESTER_RUN_ECHO</code>:</p>
<pre><code>class TesterConfig(Config):
    prefix = 'tester'
    env_prefix = 'TEST'
</code></pre>
<h3 id="modifying-default-config-values"><a class="header" href="#modifying-default-config-values">Modifying default config values</a></h3>
<p>Default config values are simple - they’re just the return value of the staticmethod <a href="https://docs.pyinvoke.org/en/stable/api/config.html#invoke.config.Config.global_defaults"><code>Config.global_defaults</code></a>, so override that and return whatever you like - ideally something based on the superclass’ values, as many defaults are assumed to exist by the rest of the system. (The helper function <a href="https://docs.pyinvoke.org/en/stable/api/config.html#invoke.config.merge_dicts"><code>invoke.config.merge_dicts</code></a> can be useful here.)</p>
<p>For example, say you want Tester to always echo shell commands by default when your codebase calls <a href="https://docs.pyinvoke.org/en/stable/api/context.html#invoke.context.Context.run"><code>Context.run</code></a>:</p>
<pre><code>from invoke import Program
from invoke.config import Config, merge_dicts

class TesterConfig(Config):
    @staticmethod
    def global_defaults():
        their_defaults = Config.global_defaults()
        my_defaults = {
            'run': {
                'echo': True,
            },
        }
        return merge_dicts(their_defaults, my_defaults)

program = Program(config_class=TesterConfig, version='0.1.0')
</code></pre>
<p>For reference, Invoke’s own base defaults (the…default defaults, you could say) are documented at <a href="https://docs.pyinvoke.org/en/stable/concepts/configuration.html#default-values">Default configuration values</a>.</p>
<script src="/note-service/python/infisearch_assets/search-ui.chinese.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/note-service/python/infisearch_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/note-service/python/';
const mode = 'target';
infisearch.init({
  searcherOptions: {
    url: base_url + 'infisearch_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('infisearch-mdbook-target'),
    fsButtonPlaceholder: 'Search',
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      searchedTermsParam: 'search',
    },
    multiSelectFilters: [
      { fieldName: 'partTitle', displayName: 'Section', defaultOptName: 'None' },
    ],
  },
});

document.getElementById('infi-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script>
<p><span data-infisearch-part-title="python三方库"></span></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../python三方库_2_fabric/invoke/4.loadingCollections.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../python三方库_2_fabric/invoke/4.loadingCollections.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="https://xjq-note.oss-cn-hangzhou.aliyuncs.com/clipboard.min.js"></script>
        <script src="https://xjq-note.oss-cn-hangzhou.aliyuncs.com/highlight.js"></script>
        <script src="/note-service/book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>